!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7279d364-0727-4ed7-922b-4293b9e74c89",e._sentryDebugIdIdentifier="sentry-dbid-7279d364-0727-4ed7-922b-4293b9e74c89")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72170],{30693:(e,t,s)=>{s.d(t,{F:()=>o});var a=s(79342),i=s(11750),n=s(88382),r=s(65146),l=s(75500);function o(){let e=(0,l.h)();return(0,n.useMemo)(()=>{var t,s;let a=Array.isArray(null==(s=e.EDIT_IMAGE_PRESETS)||null==(t=s.value)?void 0:t.presets)?e.EDIT_IMAGE_PRESETS.value.presets:[];return{editImagePresets:d.map(e=>({...e,label:e.label,presets:e.presets.map(e=>{var t,s;return{...e,prompt:null!=(s=null==(t=a.find(t=>t.presetId===e.presetId))?void 0:t.prompt)?s:""}})})).filter(e=>e.presets.some(e=>e.prompt)).map(e=>({...e,presets:e.presets.filter(e=>e.prompt)}))}},[e])}let d=[{category:"creative",icon:i.v9l,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.creative",defaults:"Creative"}),presets:[{presetId:"water-color",icon:i.RSl,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.water-color",defaults:"Watercolor"}),previewUrl:"/image-editing-preset-previews/water-color.jpg"},{presetId:"15th-century",icon:i.lqP,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.15th-century",defaults:"15th Century"}),previewUrl:"/image-editing-preset-previews/15th-century.jpg"},{presetId:"graffiti",icon:i.OKP,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.graffiti",defaults:"Graffiti"}),previewUrl:"/image-editing-preset-previews/graffiti.jpg"},{presetId:"renaissance-painting",icon:i.esB,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.renaissance-painting",defaults:"Renaissance Painting"}),previewUrl:"/image-editing-preset-previews/renaissance-painting.jpg"},{presetId:"symbolist-painting",icon:i.kU3,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.symbolist-painting",defaults:"Symbolist Painting"}),previewUrl:"/image-editing-preset-previews/symbolist-painting.jpg"},{presetId:"expressionist-painting",icon:i.vMd,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.expressionist-painting",defaults:"Expressionist Painting"}),previewUrl:"/image-editing-preset-previews/expressionist-painting.jpg"},{presetId:"cubist-painting",icon:i.M6A,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cubist-painting",defaults:"Cubist Painting"}),previewUrl:"/image-editing-preset-previews/cubist-painting.jpg"},{presetId:"ukiyo-e-painting",icon:i.GeJ,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.ukiyo-e-painting",defaults:"Ukiyo-e Painting"}),previewUrl:"/image-editing-preset-previews/ukiyo-e-painting.jpg"},{presetId:"bright-anime",icon:i.pnY,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.bright-anime",defaults:"Bright Anime"}),previewUrl:"/image-editing-preset-previews/bright-anime.jpg"},{presetId:"dark-anime",icon:i.AUI,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dark-anime",defaults:"Dark Anime"}),previewUrl:"/image-editing-preset-previews/dark-anime.jpg"},{presetId:"cyberpunk",icon:i.Qxc,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cyberpunk",defaults:"Cyberpunk"}),previewUrl:"/image-editing-preset-previews/cyberpunk.jpg"},{presetId:"retro-game",icon:i.Wud,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-game",defaults:"Retro Game"}),previewUrl:"/image-editing-preset-previews/retro-game.jpg"}]},{category:"background",icon:i.dM2,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.background",defaults:"Background"}),presets:[{presetId:"paris",icon:i.t6i,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.paris",defaults:"Paris"}),previewUrl:"/image-editing-preset-previews/paris.jpg"},{presetId:"london",icon:i.t6i,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.london",defaults:"London"}),previewUrl:"/image-editing-preset-previews/london.jpg"},{presetId:"tokyo",icon:i.t6i,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tokyo",defaults:"Tokyo"}),previewUrl:"/image-editing-preset-previews/tokyo.jpg"},{presetId:"mars",icon:i.XQK,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mars",defaults:"Mars"}),previewUrl:"/image-editing-preset-previews/mars.jpg"},{presetId:"tropical-paradise",icon:i.L71,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tropical-paradise",defaults:"Tropical Paradise"}),previewUrl:"/image-editing-preset-previews/tropical-paradise.jpg"},{presetId:"cosmic-void",icon:i.sUz,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cosmic-void",defaults:"Cosmic Void"}),previewUrl:"/image-editing-preset-previews/cosmic-void.jpg"},{presetId:"urban-rooftop",icon:i.t6i,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.urban-rooftop",defaults:"Urban Rooftop"}),previewUrl:"/image-editing-preset-previews/urban-rooftop.jpg"},{presetId:"enchanted-cave",icon:i.gDK,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.enchanted-cave",defaults:"Enchanted Cave"}),previewUrl:"/image-editing-preset-previews/enchanted-cave.jpg"},{presetId:"misty-forest",icon:i.YUH,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.misty-forest",defaults:"Misty Forest"}),previewUrl:"/image-editing-preset-previews/misty-forest.jpg"},{presetId:"retro-arcade",icon:i.ZNA,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-arcade",defaults:"Retro Arcade"}),previewUrl:"/image-editing-preset-previews/retro-arcade.jpg"},{presetId:"space-station",icon:i.f36,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.space-station",defaults:"Space Station"}),previewUrl:"/image-editing-preset-previews/space-station.jpg"},{presetId:"desert-oasis",icon:i.L71,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.desert-oasis",defaults:"Desert Oasis"}),previewUrl:"/image-editing-preset-previews/desert-oasis.jpg"},{presetId:"volcano-lair",icon:i.Q5j,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.volcano-lair",defaults:"Volcano Lair"}),previewUrl:"/image-editing-preset-previews/volcano-lair.jpg"},{presetId:"post-apocalypse",icon:i.A1H,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.post-apocalypse",defaults:"Post-Apocalypse"}),previewUrl:"/image-editing-preset-previews/post-apocalypse.jpg"}]},{category:"subject",icon:i.BDI,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.subject",defaults:"Subject"}),presets:[{presetId:"stylish-hat",icon:i.fbd,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.stylish-hat",defaults:"Stylish Hat"}),previewUrl:"/image-editing-preset-previews/stylish-hat.jpg"},{presetId:"mustache",icon:i.Hx3,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mustache",defaults:"Mustache"}),previewUrl:"/image-editing-preset-previews/mustache.jpg"},{presetId:"superhero-costume",icon:i.KqI,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.superhero-costume",defaults:"Superhero Costume"}),previewUrl:"/image-editing-preset-previews/superhero-costume.jpg"},{presetId:"golden-glow",icon:i.S7m,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.golden-glow",defaults:"Golden Glow"}),previewUrl:"/image-editing-preset-previews/golden-glow.jpg"},{presetId:"mecha-warrior",icon:i.cC5,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mecha-warrior",defaults:"Mecha Warrior"}),previewUrl:"/image-editing-preset-previews/mecha-warrior.jpg"},{presetId:"sunglasses-jacket",icon:i.ljW,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.sunglasses-jacket",defaults:"Sunglasses & Jacket"}),previewUrl:"/image-editing-preset-previews/sunglasses-jacket.jpg"},{presetId:"medieval-armor",icon:i.ekZ,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.medieval-armor",defaults:"Medieval Armor"}),previewUrl:"/image-editing-preset-previews/medieval-armor.jpg"},{presetId:"time-traveler",icon:i.zD7,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.time-traveler",defaults:"Time Traveler"}),previewUrl:"/image-editing-preset-previews/time-traveler.jpg"},{presetId:"hologram-effect",icon:i.srL,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.hologram-effect",defaults:"Hologram Effect"}),previewUrl:"/image-editing-preset-previews/hologram-effect.jpg"},{presetId:"dragon-rider",icon:i.Q5j,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dragon-rider",defaults:"Dragon Rider"}),previewUrl:"/image-editing-preset-previews/dragon-rider.jpg"},{presetId:"remove-people",icon:i.Kr6,label:(0,a.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.remove-people",defaults:"Remove People"}),previewUrl:"/image-editing-preset-previews/remove-people.jpg"}]}]},38362:(e,t,s)=>{s.d(t,{g:()=>x});var a=s(79342),i=s(19093),n=s(52553),r=s(23232),l=s(98100),o=s(92437),d=s(70888),c=s(11750),u=s(84969),m=s(23054),p=s(74995),g=s(65146),h=s(38614);function x(e){let{conversationId:t,containerRef:s,user:x,imageAttachmentsOnly:f=!1}=e,{t:v}=(0,g.Bd)("chat"),y=function(e,t,s){let a=(0,h.aP)(p.A("activeModelId")),{modelById:c}=(0,l.GB)(),u=null==c?void 0:c[a],{isAttachDisabled:m}=(0,l.QG)(u),{attachFiles:g}=(0,n.S)(),x=(0,r._)(),{user:f}=(0,i.useSession)(),v=(0,d.x)(p.A("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,o.t)({onDrop:e=>{f&&(g(e),e.forEach(e=>{x("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>{var t;return!m&&!!e.files.length&&(!s||!(e.files.length>1)&&!!(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))&&(!v.length||!v.find(t=>{var s;return t.file.name===(null==(s=e.files[0])?void 0:s.name)}))},ref:t},[v,f,m,g])}(t,s,f),b=(0,h.aP)(p.A("activeModelId")),{modelById:j}=(0,l.GB)(),w=null==j?void 0:j[b],{isAttachDisabled:I,isThinkSelected:N,isDeepsearchSelected:k}=(0,l.QG)(w);return(0,a.jsx)(u.N,{children:y&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,a.jsx)(m.P.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:x?I?(0,a.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,a.jsx)("div",{children:(0,a.jsx)(c.lW3,{size:32,className:"text-red-400"})}),(0,a.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:v("Attachments are disabled","Attachments are disabled")}),(0,a.jsxs)("p",{className:"text-secondary",children:[v("Attachments are disabled for","Attachments are disabled for")," ",(0,a.jsx)("span",{className:"font-semibold",children:N?"Think":k?"DeepSearch":void 0})]})]}):(0,a.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,a.jsx)("div",{children:(0,a.jsx)(c.XGR,{size:32,className:"text-secondary"})}),(0,a.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:v("Drop your files here","Drop your files here")}),(0,a.jsx)("p",{className:"text-secondary",children:v("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,a.jsx)("div",{children:(0,a.jsx)(c.XGR,{size:32,className:"text-secondary"})}),(0,a.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:v("Sign in to attach files!","Sign in to attach files!")}),(0,a.jsx)("p",{className:"text-secondary",children:v("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}},40016:(e,t,s)=>{s.d(t,{q:()=>p});var a=s(79342),i=s(38614),n=s(11750),r=s(61312),l=s(97960),o=s(23054),d=s(74995),c=s(88382),u=s(65146),m=s(63174);let p=e=>{let{className:t,hasImage:s,inputValue:p,isStreaming:g,onInputValueChange:h,onSend:x,onAbort:f}=e,{t:v}=(0,u.Bd)("base"),y=(0,i.aP)(d.A("lastMessageId")),b=(0,i.aP)(d.A("streamedMessageId")),j=(0,l.A3)(d.A("byId")),w=(0,c.useRef)(null),I=(0,c.useRef)(null),[N,k]=(0,c.useState)(!1),S=(0,c.useMemo)(()=>g||!s,[g,s]),C=(0,c.useMemo)(()=>!N&&!g&&s&&!!p.trim(),[N,s,p,g]),M=(0,c.useCallback)(async e=>{var t;e.preventDefault(),!S&&p.trim()&&(k(!0),await (null==(t=x(p))?void 0:t.finally(()=>{var e;null==(e=I.current)||e.focus(),k(!1)})))},[x,S,p]),P=(0,c.useMemo)(()=>{let e=b?j[b]:void 0;if((null==e?void 0:e.parentResponseId)===y)return e},[b,j,y]),E=(0,c.useMemo)(()=>{if(g)return(null==P?void 0:P.state)||"closed"},[g,P]),_=(0,c.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=w.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,a.jsxs)("form",{className:(0,r.cn)("w-full rounded-[32px] p-3 bg-input-background shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset",t),onSubmit:M,ref:w,children:[(0,a.jsx)(m.A,{ref:I,className:(0,r.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5",g&&"animate-pulse"),onChange:e=>h(e.target.value),value:p,placeholder:s?g?v("Editing image","Editing image"):v("Describe your edits","Describe your edits"):v("Upload an image to begin","Upload an image to begin"),minRows:1,onKeyDown:_,autoFocus:!0,disabled:S,name:"query",maxRows:5}),(0,a.jsx)("div",{className:(0,r.cn)("ml-auto flex flex-row items-end gap-1"),children:g&&("streaming"===E||"reconnecting"===E)?(0,a.jsx)(o.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),onClick:e=>{e.preventDefault(),f().catch(console.error)},children:(0,a.jsx)("div",{className:(0,r.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,a.jsx)(n.M6A,{size:20})})}):(0,a.jsx)(o.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:s?{scale:1.1}:void 0,whileTap:s?{scale:.95}:void 0,className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":v("Submit","Submit"),disabled:!C,children:(0,a.jsx)("div",{className:(0,r.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",C?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,a.jsx)(n.Kpk,{size:20,className:"relative"})})})})]})}},68217:(e,t,s)=>{s.d(t,{K:()=>g});var a=s(625),i=s(42557),n=s(24734),r=s(17703),l=s(95158),o=s(56907),d=s(20014),c=s(88382),u=s(98579),m=s(4878),p=s(39489);function g(e){let{pageSize:t=60,orderBy:s="createTime"}=e,g=(0,i.wV)(),h=(0,u.o)(),x=g.user,f=(0,n.K)(),{currentTeam:v,isSwitchingTeam:y}=(0,a.hd)(),{ASSET_SERVER_URL:b}=(0,p.v)(),{data:j,isLoading:w}=(0,o.IT)({queryKey:["team-members",null==v?void 0:v.teamId],enabled:!!(null==v?void 0:v.teamId),queryFn:async()=>l.wM.authManagementListUsers({teamId:v.teamId}).then(e=>{var t;return(null==(t=e.members)?void 0:t.filter(e=>{var t;return(null==(t=e.user)?void 0:t.userId)!==(null==x?void 0:x.userId)}))||[]}).catch(e=>((0,r.vV)("share-dialog:fetch-team-members",e),[]))}),I=(0,c.useMemo)(()=>{let e=new Map;return null==j||j.forEach(t=>{var s,a,i,n,r,l;e.set((null==(s=t.user)?void 0:s.userId)||"",{userId:(null==(a=t.user)?void 0:a.userId)||"",xUserId:(null==(i=t.user)?void 0:i.xUserId)||"",givenName:(null==(n=t.user)?void 0:n.givenName)||"",familyName:(null==(r=t.user)?void 0:r.familyName)||"",profileImageUrl:(0,m.sU)(b,null==(l=t.user)?void 0:l.profileImage)})}),e},[j,b]),N=(0,c.useRef)(null),k=(0,c.useRef)(null),[S,C]=(0,c.useState)(!1),[M,P]=(0,c.useState)(!1),E=(0,c.useCallback)(async e=>{let{pageParam:a}=e;if(!x)return{shareLinkResults:[],nextPageToken:void 0};try{let{shareLinks:e,nextPageToken:i}=await l.chatApi.chatListShareLinks({sharedWithMe:!0,pageToken:"string"==typeof a?a:void 0,pageSize:t.toString(),orderBy:"createTime"===s?"LIST_SHARE_LINKS_ORDER_BY_CREATE_TIME":"viewCount"===s?"LIST_SHARE_LINKS_ORDER_BY_VIEW_COUNT":"LIST_SHARE_LINKS_ORDER_BY_INVALID"});return{shareLinkResults:(null==e?void 0:e.map(e=>{var t;let{sharedLink:s,...a}=e;return{...a,conversation:(null==s?void 0:s.conversation)||null,response:(null==s||null==(t=s.responses)?void 0:t.find(t=>t.responseId===e.responseId))||null}}))||[],nextPageToken:i}}catch(e){throw f("use-search-conversations",e),e}},[x,f,t,s]),{data:_,fetchNextPage:A,hasNextPage:T,isFetchingNextPage:R,isFetching:O,isError:U,isLoading:D,refetch:z}=(0,o.qu)({queryKey:["share-links",null==x?void 0:x.userId,t,s],queryFn:E,initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,enabled:!!x&&!!(null==v?void 0:v.teamId)&&!y,staleTime:6e5,refetchOnWindowFocus:!0}),L=(0,c.useMemo)(()=>{var e;let t=(null==_||null==(e=_.pages.flatMap(e=>e.shareLinkResults))?void 0:e.filter(e=>!!e.shareLinkId))||[],a="createTime"===s?t.sort((e,t)=>new Date((null==t?void 0:t.createTime)||Date.now()).getTime()-new Date((null==e?void 0:e.createTime)||Date.now()).getTime()):t.sort((e,t)=>parseInt(t.viewCount||"0")-parseInt(e.viewCount||"0"));return d.A(e=>null==e?void 0:e.shareLinkId,a).map(e=>({...e,user:(null==e?void 0:e.xaiUserId)?I.get(e.xaiUserId):void 0}))},[null==_?void 0:_.pages,I,s]),K=(0,c.useCallback)(e=>{let t=L.find(t=>t.shareLinkId===e);return(null==t?void 0:t.publicId)?h(t.publicId):h(e)},[L,h]),B=(0,c.useCallback)(e=>{window.location.href=K(e)},[K]);return(0,c.useEffect)(()=>{if(!(null==N?void 0:N.current)||!(null==k?void 0:k.current))return;let e=new IntersectionObserver(e=>{let[t]=e;t&&C(t.isIntersecting)},{root:k.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=N.current;if(t)return e.observe(t),()=>{e.unobserve(t)}},[null==N?void 0:N.current,null==k?void 0:k.current]),(0,c.useLayoutEffect)(()=>{S&&T&&!R&&x&&!M&&(P(!0),A().catch(e=>(0,r.vV)("intersection-load-more",e)))},[S,T,R,A,x,M]),(0,c.useEffect)(()=>{if(M){let e=setTimeout(()=>{P(!1)},300);return()=>clearTimeout(e)}},[M]),{results:L,refetch:z,loadMoreRef:N,containerRef:k,isLoading:D,isFetching:O,isError:U,isLoadingTeamMembers:w,getShareLinkHref:K,handleNavigateToSharedConversation:B}}},72170:(e,t,s)=>{s.d(t,{A:()=>tX});var a=s(79342),i=s(13010),n=s(44428),r=s(82591),l=s(10953),o=s(38614),d=s(15041),c=s(39489),u=s(52244),m=s(11750),p=s(56691),g=s(30693),h=s(4295),x=s(12220),f=s(17703),v=s(84969),y=s(23054),b=s(88382),j=s(65146),w=s(43086);let I=e=>{let{hasImage:t,prompt:s,onParentPeek:i,focusedImageUrl:n,parentImageUrl:r,isStreaming:l,onRegenerate:d,onClose:c}=e,{t:I}=(0,j.Bd)("base"),[N,k]=(0,b.useState)(!1),[S,C]=(0,b.useState)(void 0),[M,P]=(0,b.useState)(!1),E=(0,h.c)(),_=(0,o.aP)(e=>e.conversationId),A=(0,o.aP)(e=>e.lastMessageId),{editImagePresets:T}=(0,g.F)(),R=(0,b.useMemo)(()=>{if(!S)return;let e=T.flatMap(e=>e.presets).find(e=>e.prompt===S);return e?(0,a.jsxs)(a.Fragment,{children:[e.icon&&b.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,a.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,a.jsx)("h1",{className:"text-lg font-semibold truncate",children:S})},[S,T]),O=(0,b.useCallback)(()=>{!M&&n&&(P(!0),(0,x.G)(n,null==n?void 0:n.split("/").pop()).catch((0,f.HX)("image-editor:handleDownload")).finally(()=>P(!1)))},[n,M]);return(0,b.useEffect)(()=>{s&&S!==s&&C(s)},[s,S]),(0,b.useEffect)(()=>{r&&!N&&k(!0)},[r,N]),(0,a.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,a.jsxs)(v.N,{mode:"popLayout",children:[S&&(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:R},S),(0,a.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(0,a.jsxs)(a.Fragment,{children:[N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Compare","Compare"),tooltipContent:I("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!r,children:(0,a.jsx)(y.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,a.jsx)(m.Uye,{className:"size-5"})})})},"compare"),(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Regenerate","Regenerate"),tooltipContent:I("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!r,onClick:d,children:(0,a.jsx)(y.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,a.jsx)(m.V$7,{className:"size-5"})})})},"regenerate")]}),t&&(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(p.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":I("Download Image","Download Image"),tooltipContent:I("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||M,onClick:O,children:M?(0,a.jsx)(w.y,{size:"xs"}):(0,a.jsx)(m.s3U,{className:"size-5"})})},"download"),_&&A&&(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,a.jsx)(u.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:_,responseId:A,iconProps:{size:20}})},"share")]}),E?(0,a.jsx)(p.$n,{"aria-label":I("Close Image Editor","Close Image Editor"),variant:"filled",size:"iconMd",rounded:!0,onClick:c,children:(0,a.jsx)(m.uv5,{size:20})}):(0,a.jsx)(p.gx,{"aria-label":I("Close Image Editor","Close Image Editor"),tooltipContent:I("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"filled",size:"md",rounded:!0,onClick:c,children:I("Close","Close")})]})]})})};var N=s(28951),k=s(61312);let S=e=>{let{images:t,focusedOption:s,isStreaming:i,onSelect:n}=e;return(0,a.jsx)(y.P.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsx)(v.N,{mode:"popLayout",children:t.map((e,t)=>(0,a.jsx)(y.P.button,{className:(0,k.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":t===s}),onClick:()=>n(t),whileTap:t!==s?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,a.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,a.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,a.jsx)(N.L,{isModerated:e.isModerated,status:i?"streaming":"finished",iconSize:24,intermediateResults:i?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var C=s(40016),M=s(67153),P=s(75500),E=s(66408),_=s(69643),A=s(23232),T=s(4878),R=s(70888),O=s(59075),U=s(97960),D=s(44347),z=s(74995),L=s(14908);let K=e=>{let{isEditingCurrentImage:t,setIsPeekingParent:s,isPeekingParent:i,focusedImage:n,parentImageUrl:r,generatedImageHeight:l,generatedImageWidth:o,isFinalImageLoaded:d,setIsFinalImageLoaded:c,isParentImageLoaded:u,setIsParentImageLoaded:m}=e,[p,g]=(0,b.useState)([]),[h,x]=(0,b.useState)(!1),[f,j]=(0,b.useState)(!1),[w,I]=(0,b.useState)(!0),S=(0,b.useMemo)(()=>!!(l&&o),[l,o]),C=(0,b.useMemo)(()=>l&&o?o/l:4/3,[l,o]);return(0,b.useEffect)(()=>{(t||!w)&&(null==n?void 0:n.progressMap)?g(n.progressMap):!t&&(null==n?void 0:n.url)?g(e=>[...e,{progress:1,imageUrl:n.url||""}]):g([])},[t,null==n?void 0:n.url,null==n?void 0:n.progressMap,w]),(0,b.useEffect)(()=>{if(!h)return void s(!1);let e=setTimeout(()=>{h&&!f&&s(!0)},100);return()=>clearTimeout(e)},[h,f,s]),(0,b.useEffect)(()=>{t&&w&&I(!1),t||!d||w||I(!0)},[t,d,w]),(0,a.jsx)("figure",{className:(0,k.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!t&&r&&(i?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(i)return void e.preventDefault();j(!0)},onDragEnd:()=>{j(!1),x(!1)},onMouseDown:e=>{0===e.button&&x(!0)},onMouseUp:()=>x(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),x(!0)},onTouchEnd:e=>{e.preventDefault(),x(!1)},onMouseLeave:()=>{x(!1),j(!1)},children:(0,a.jsx)(v.N,{mode:"wait",children:t||!w?S?(0,a.jsx)(y.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:C,maxHeight:l},children:(0,a.jsx)(N.L,{status:"streaming",intermediateResults:p,isModerated:null==n?void 0:n.isModerated,aspectRatio:C})},"streaming-image"):(0,a.jsx)(B,{}):(0,a.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,a.jsxs)(a.Fragment,{children:[!d&&(0,a.jsx)(B,{className:"absolute z-20 inset-0"}),(0,a.jsx)(y.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&i||!d?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>c(!0)},"finished-image")]}),(0,a.jsx)(v.N,{children:!t&&r&&i&&(0,a.jsxs)(y.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,a.jsx)(B,{className:"absolute z-20 inset-0"}),(0,a.jsx)(y.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>m(!0)},"parent-image")]},"parent-image-container")})]})})})},B=e=>{let{className:t}=e;return(0,a.jsx)(y.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,k.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,a.jsx)(m.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var H=s(41320),q=s(4423),F=s(43035),G=s(93220),W=s(34500),V=s(73772);let $=e=>{let{hasImage:t,onSend:s,isStreaming:i}=e,{editImagePresets:n}=(0,g.F)(),r=(0,H.Di)(),{t:l}=(0,j.Bd)("image-editor"),[o,d]=(0,b.useState)(null),[c,u]=(0,b.useState)(null),h=(0,b.useMemo)(()=>i||!t,[i,t]),x=(0,b.useCallback)(e=>{d(t=>t===e?null:e)},[d]),f=(0,b.useCallback)(e=>{if(!i)return d(null),s(e.prompt,e.presetId)},[i,s]),v=(0,b.useCallback)(()=>{if(!i)return d(null),s("Make video","make-video")},[i,s]),w=(0,b.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let s=t.getBoundingClientRect();return s.right+12+200>window.innerWidth?{left:s.left-200-12,top:s.top+(s.height-150)/2}:{left:s.right+12,top:s.top+(s.height-150)/2}},[]);return(0,b.useEffect)(()=>{if(!o||r)return void u(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&u(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[o,r]),(0,a.jsxs)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:[(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut"},className:"bg-surface-base rounded-full",children:(0,a.jsxs)(p.$n,{variant:"filledSecondary",size:"md",className:"flex items-center justify-start py-3 border border-border-l1 rounded-3xl hover:text-fg-primary",onClick:v,children:[(0,a.jsx)(m.jGG,{fill:"currentColor",strokeWidth:0,className:"size-4"}),l("button.make-video","Make video")]},"make-video")},"make-video-animation"),n.map((e,t)=>(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*(t+1)},className:"bg-surface-base rounded-full",children:r?(0,a.jsxs)(W._s,{open:e.category===o,onOpenChange:t=>{t?d(e.category):d(null)},children:[(0,a.jsx)(W.Uz,{disabled:h,asChild:!0,children:(0,a.jsx)(Y,{category:e,disabled:h})}),(0,a.jsxs)(W.zj,{className:"max-h-[90dvh]",children:[(0,a.jsx)(W.BE,{children:(0,a.jsxs)(W.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&b.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,a.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,a.jsxs)(p.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>f(e),children:[e.icon&&b.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,a.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,a.jsxs)(V.rI,{open:e.category===o,onOpenChange:()=>x(e.category),children:[(0,a.jsx)(V.ty,{disabled:h,asChild:!0,children:(0,a.jsx)(Y,{category:e,disabled:h})}),(0,a.jsx)(V.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5 z-[100000]",onMouseLeave:()=>{u(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(t=>(0,a.jsxs)(V._2,{"data-preset-id":t.presetId,className:"flex items-center gap-2",onSelect:()=>f(t),children:[t.icon&&b.createElement(t.icon,{size:16,className:"text-secondary flex-shrink-0"}),t.label,c===t.presetId&&(0,F.createPortal)((0,a.jsxs)(y.P.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:w(t.presetId),children:[(0,a.jsx)(G.$,{className:"absolute inset-0"}),t.previewUrl&&(0,a.jsx)(q.default,{src:t.previewUrl,alt:t.presetId,width:200,height:150,priority:!r&&o===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},t.presetId))})]})},e.category))]})},Y=b.forwardRef((e,t)=>{let{category:s,disabled:i,...n}=e;return(0,a.jsxs)(p.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,k.cn)(!i&&"*:hover:text-primary transition-all"),disabled:i,...n,children:[s.icon&&b.createElement(s.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,a.jsx)("span",{children:s.label})]})});var Q=s(24734);let X=e=>{let{onUploadImage:t}=e,{t:s}=(0,j.Bd)("base"),i=(0,R.x)(z.A("fetchUploadFile")),n=(0,R.x)(z.A("removeByConversationId")),r=(0,o.aP)(z.A("conversationId")),{ASSET_SERVER_URL:l}=(0,c.v)(),d=(0,Q.K)(),u=(0,b.useRef)(null),[g,h]=(0,b.useState)(!1),[x,f]=(0,b.useState)(!1),I=(0,b.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),N=(0,b.useCallback)(async e=>{let a;if(1!==e.length||!e[0])return void L.oR.error(s("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void L.oR.error(s("Only image files are allowed","Only image files are allowed"));f(!0);try{let t=i(e[0],r||"no_conversation_id");a=await t.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}a instanceof Error&&d("image-editor-upload:uploadFile",a,s("Failed to upload file","Failed to upload file")),f(!1),n(r||"no_conversation_id"),!a||a instanceof Error||t({url:(0,T.sU)(l,a.fileUri),metadata:a})},[s,i,r,t,l,n,d]),k=(0,b.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),x||h(!0)},[x]),S=(0,b.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h(!1)},[]),C=(0,b.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),h(!1),!x)return N(Array.from(e.dataTransfer.files))},[N,x]),M=(0,b.useCallback)(e=>{if(e.target.files)return N(Array.from(e.target.files)).finally(()=>{u.current&&(u.current.value="")})},[N]);return(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:k,onDragLeave:S,onDrop:C,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(g&&!x&&"bg-surface-l1 border-border-l1"),children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,a.jsx)(v.N,{mode:"popLayout",children:g&&!x?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(m.sv7,{className:"size-6"})},"files"):(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(m.XGR,{className:"size-6"})},"image-plus")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-primary",children:s("Upload an image to begin","Upload an image to begin")}),(0,a.jsx)(v.N,{mode:"popLayout",children:x?(0,a.jsx)(y.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Uploading image","Uploading image")},"uploading"):g?(0,a.jsx)(y.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Drop image here","Drop image here")},"dragging"):(0,a.jsx)(y.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsxs)(p.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:x,autoFocus:!0,onClick:I,children:[x?(0,a.jsx)(w.y,{size:"xxs"}):(0,a.jsx)(m._OO,{className:"size-4 text-fg-secondary"}),s("Upload","Upload")]})}),(0,a.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:M,multiple:!1,"data-testid":"file-input"})]})})};var J=s(63278);let Z=()=>{let{ASSET_SERVER_URL:e}=(0,c.v)(),t=(0,P.h)(),s=(0,A._)(),{t:i}=(0,j.Bd)("base"),n=(0,M.L)(),{handleSendStart:r,timeToSendStart:l,consumeTimeToSendMs:u}=(0,E.Q)(),[m,p]=(0,_.M)("image-editor-first-open",!0),g=(0,O.j)(z.A("isOpen")),h=(0,O.j)(z.A("currentImage")),x=(0,O.j)(z.A("setImage")),y=(0,o.aP)(z.A("conversationId")),w=(0,o.aP)(z.A("streamedMessageId")),N=(0,o.aP)(z.A("lastMessageId")),k=(0,U.A3)(e=>e.byId[null!=w?w:""]),B=(0,U.A3)(z.A("byId")),H=(0,b.useMemo)(()=>{var e;return null!=(e=U.A3.getState().byConversationId[null!=y?y:""])?e:[]},[y]),q=(0,J.S)(),[F,G]=(0,b.useState)(""),[W,V]=(0,b.useState)(!1),[Y,Q]=(0,b.useState)(null),[Z,ee]=(0,b.useState)(!1),[et,es]=(0,b.useState)(!1),[ea,ei]=(0,b.useState)(!1),[en,er]=(0,b.useState)(!1),[el,eo]=(0,b.useState)(!1),ed=(0,b.useMemo)(()=>!!h,[h]),ec=(0,b.useMemo)(()=>!!(h&&"key"in h),[h]),eu=(0,b.useMemo)(()=>!!(h&&"metadata"in h),[h]),em=(0,b.useMemo)(()=>{if(ec){if(W)return!Y&&k&&Q(k.responseId),k||B[null!=Y?Y:""];let e=H.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let s=e.streamingImageById[t][100];if((null==s?void 0:s.imageUrl)===(null==h?void 0:h.url))return!0}});return e||(null==H?void 0:H.find(e=>{var t,s;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(s=h.assetKey)?s:"")}))}},[h,H,ec,W,k,Y,B]),ep=(0,b.useMemo)(()=>(null==em?void 0:em.parentResponseId)?B[em.parentResponseId]:void 0,[em,B]),eg=(0,b.useMemo)(()=>ep?(0,T.sU)(e,ep.imageEditUri):void 0,[ep,e]),eh=(0,b.useMemo)(()=>{if(eu){var t,s;return[{id:null!=(t=h.metadata.fileUri)?t:"",url:null!=(s=(0,T.sU)(e,h.metadata.fileUri))?s:"",isModerated:!1,progressMap:void 0}]}return ec?em?W&&em.streamingImageById?Object.entries(em.streamingImageById).map(t=>{var s;let[a,i]=t,n=Object.keys(i).map(Number),r=i[Math.max(...n)];return{id:a,url:null!=(s=(0,T.sU)(e,null==r?void 0:r.imageUrl))?s:"",isModerated:!1,progressMap:n.map(t=>{var s,a;return{progress:t/100,imageUrl:null!=(a=(0,T.sU)(e,null==(s=i[t])?void 0:s.imageUrl))?a:""}})}}):em.generatedImageUrls.map(t=>{var s,a,i;let n=null!=(a=Object.values(null!=(s=em.streamingImageById)?s:{})[0])?a:{},r=Object.keys(n).map(Number);return{id:t,url:null!=(i=(0,T.sU)(e,t))?i:"",isModerated:!1,progressMap:r.length>0?r.map(t=>{var s,a;return{progress:t/100,imageUrl:null!=(a=(0,T.sU)(e,null==(s=n[t])?void 0:s.imageUrl))?a:""}}):void 0}}):[]:[]},[h,em,ec,W,e,eu]),ex=(0,b.useMemo)(()=>eh.length>1?eh.find(e=>e.id===(null==h?void 0:h.key)||e.id===(null==h?void 0:h.assetKey)):eh[0],[eh,h]),ef=(0,b.useMemo)(()=>(0,a.jsx)(K,{isEditingCurrentImage:W,focusedImage:ex,parentImageUrl:en?void 0:eg,isPeekingParent:Z,setIsPeekingParent:ee,generatedImageWidth:null==em?void 0:em.generatedImageWidth,generatedImageHeight:null==em?void 0:em.generatedImageHeight,isParentImageLoaded:ea,isFinalImageLoaded:el,setIsFinalImageLoaded:eo,setIsParentImageLoaded:ei}),[W,ex,Z,eg,null==em?void 0:em.generatedImageWidth,null==em?void 0:em.generatedImageHeight,ea,el,en]),ev=(0,b.useCallback)(()=>{(null==ex?void 0:ex.url)&&q(ex.url).catch(e=>{(0,f.vV)("image-editor:handleMakeVideo",e)})},[null==ex?void 0:ex.url,q]),ey=(0,b.useCallback)(e=>{e&&x(e)},[x]),eb=(0,b.useCallback)(e=>{let t=eh[e];t&&(W&&x({key:t.id}),x({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1}))},[eh,W,x]),ej=(0,b.useCallback)(async e=>(es(!0),e().finally(()=>{es(!1)})),[]),ew=(0,d.m)("image-workbench:handleAbort",ej),eI=(0,b.useCallback)(async(e,s)=>{if(!e.trim()||!(null==h?void 0:h.url))throw Error("No message or image");let a=o.aP.getState(),i=D.C$.getState(),r=U.A3.getState(),l=R.x.getState(),d=s.replace(/^https?:\/\/[^/]+\/?/,"");G(""),l.removeByConversationId(a.conversationId||"no_conversation_id"),l.removeAttachByConversationId(a.conversationId||"no_conversation_id"),await n();let c=a.lastMessageId?r.byId[a.lastMessageId]:void 0;if(a.lastMessageId&&!c)throw Error("Last message is missing");if((null==c?void 0:c.sender)==="human")throw Error("Last message is human");"none"!==a.reasoningMode&&a.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:d,enableRetries:t.ENABLE_AUTO_STREAM_RETRY},m=eu&&h.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[h.metadata.fileMetadataId]:[];if(eu)return a.conversationId?a.sendResponse({...u,parentResponseId:a.lastMessageId,conversationId:a.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t}):a.establishNewConversation({...u,fileAttachmentIds:[h.metadata.fileMetadataId],temporary:i.isIncognito,ff:t});if(!a.conversationId)throw Error("No conversation id");return a.sendResponse({...u,parentResponseId:a.lastMessageId,conversationId:a.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t})},[h,n,eu,ep,t]),eN=(0,b.useCallback)(async(e,t)=>{let s=o.aP.getState(),a=U.A3.getState(),i=s.streamedMessageId?a.byId[s.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==i?void 0:i.state)||"closed")&&await ew(),V(!0),eI(e,t).catch(()=>{O.j.getState().close()})},[eI,ew]),ek=(0,b.useCallback)(async(e,t)=>{if(e.trim()&&(null==ex?void 0:ex.url))return(s("edit_image_start",(0,E.r)(ex.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(u())}),"make-video"===t)?ev():eN(e,ex.url).catch(e=>{(0,f.vV)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[eN,ex,s,u,ev]),eS=(0,b.useCallback)(()=>{if((null==ep?void 0:ep.message)&&eg)return s("edit_image_start",(0,E.r)(eg),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(u())}),eN(ep.message,eg).catch(e=>{(0,f.vV)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,eg,eN,s,u]);(0,b.useEffect)(()=>{W&&eh.length&&eh[0]&&!eh.find(e=>e.id===h.key)&&x({key:eh[0].id})},[eh,W,h,x]),(0,b.useEffect)(()=>{let t=O.j.getState();if(W&&k&&"error"===k.state)return t.close();if(W&&Y&&k&&"closed"===k.state){var a,i,n,r;if(V(!1),Q(null),!N)return t.close();let l=B[N];if(!l)return t.close();let o=null==(n=l.streamingImageById)||null==(i=n[null!=(r=null==h?void 0:h.key)?r:""])||null==(a=i[100])?void 0:a.imageUrl;if(!o)return t.close();s("edit_image_end",(0,E.r)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),x({key:o,assetKey:o,url:(0,T.sU)(e,o),progress:100,isModerated:!1})}},[ep,k,W,Y,N,B,e,s,x]),(0,b.useEffect)(()=>{W||et||void 0!==l||r()},[u,r,W,et,l]),(0,b.useEffect)(()=>{if(null==ex?void 0:ex.url){eo(!1);let e=new Image;e.onload=()=>eo(!0),e.src=ex.url}},[null==ex?void 0:ex.url]),(0,b.useEffect)(()=>{if(eg){ei(!1),er(!1);let e=new Image;e.onload=()=>ei(!0),e.onerror=()=>er(!0),e.src=eg}},[eg]),(0,b.useEffect)(()=>{m&&g&&(p(!1),L.oR.message((0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-fg-primary font-bold",children:i("image-editor-welcome.title","Welcome to Image Editor")}),(0,a.jsx)("p",{className:"text-fg-secondary",children:i("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[m,g,p,i]);let eC=(0,O.j)(z.A("close"));return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,a.jsx)(I,{hasImage:ed,prompt:eg?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==ex?void 0:ex.url,parentImageUrl:en?void 0:eg,isStreaming:W||et,onParentPeek:e=>ee(e),onClose:eC,onRegenerate:eS}),ed?ef:g&&(0,a.jsx)(X,{onUploadImage:ey}),(0,a.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,a.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,a.jsx)(v.N,{mode:"popLayout",children:ed&&eh&&eh.length>1&&(0,a.jsx)(S,{isStreaming:W||et,images:eh,focusedOption:eh.findIndex(e=>e.id===(null==ex?void 0:ex.id))||0,onSelect:eb})}),(0,a.jsx)($,{hasImage:ed,isStreaming:W||et,onSend:ek}),(0,a.jsx)(C.q,{hasImage:ed,inputValue:F,isStreaming:W||et,onInputValueChange:G,onSend:ek,onAbort:ew})]})})]})};var ee=s(13103),et=s(53592),es=s(84852);let ea=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,A._)(),s=(0,O.j)(z.A("isOpen")),i=(0,O.j)(z.A("close")),n=(0,o.aP)(z.A("conversationId")),[r,l]=(0,b.useState)(void 0),{handleEditorOpen:d,consumeEditorTimeMs:c,editorOpenTime:u}=(0,E.Q)();return(0,b.useEffect)(()=>{s&&void 0===u?d():s||void 0===u||t("image_editor_close",void 0,{timeInEditorMs:String(c()),location:"image-editor-dialog"})},[s,d,c,t,u]),(0,b.useEffect)(()=>{n!==r&&(r&&i(),l(n))},[n,i,r]),(0,a.jsx)(et.lG,{open:s,onOpenChange:e=>{e||i()},children:(0,a.jsxs)(ee.ZJ,{children:[(0,a.jsx)(et.LC,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,a.jsxs)(et.Cf,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,k.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,a.jsx)(es.s,{children:(0,a.jsx)(ee.L3,{children:e("image-editor.title","Image editor")})}),(0,a.jsx)(Z,{})]})]})})};var ei=s(19093),en=s(48795),er=s(95739),el=s(68332),eo=s(46748),ed=s(35181),ec=s(89482),eu=s(84499),em=s(49972),ep=s(39116),eg=s(10084),eh=s(51459),ex=s(13504),ef=s(5663),ev=s(33231),ey=s(24429),eb=s(71865),ej=s(26067),ew=s(625);let eI=e=>{let{height:t,width:s}=e,{i18n:i}=(0,j.Bd)("chat"),{isSuperGrokUser:n,isSuperGrokProUser:r}=(0,ey.Q2)(),{isSwitchingTeam:o}=(0,ew.hd)(),d=(0,eb.n)(),c=(0,D.C$)(z.A("selectedLanguage")),[u,m]=(0,b.useState)(0),p=(0,b.useMemo)(()=>c||i.languages.find(e=>e in ej.IV)||ej.GG,[c,i.languages]),[g,h]=(0,b.useState)({isSuperGrokProUser:r,isSuperGrokUser:n,usingGrokTeams:d});return(0,b.useEffect)(()=>{o||h(e=>(e.usingGrokTeams!==d&&m(e=>e+1),{isSuperGrokProUser:r,isSuperGrokUser:n,usingGrokTeams:d}))},[r,n,d,o,h]),(0,a.jsx)(v.N,{mode:"wait",initial:!1,children:(0,a.jsx)(y.P.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:g.usingGrokTeams?(0,a.jsx)(l.Mm,{height:t,width:s}):g.isSuperGrokProUser?"ja"===p?(0,a.jsx)(l.bi,{height:t,width:s}):(0,a.jsx)(l.dq,{height:t,width:s}):g.isSuperGrokUser?"ja"===p?(0,a.jsx)(l.cq,{height:t,width:s}):(0,a.jsx)(l.Xd,{height:t,width:s}):"ja"===p?(0,a.jsx)(l.cT,{height:t,width:s}):(0,a.jsx)(l.kk,{height:t,width:s})},"logo-".concat(u))})};var eN=s(18585),ek=s(82767),eS=s(65912),eC=s(98100),eM=s(44845),eP=s(82127),eE=s(34140),e_=s(73304),eA=s(20301),eT=s(6132);let eR=eT.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport","finance"]),eO=eT.z.object({type:eT.z.literal("stockMiniSummary"),summary:eT.z.object({ticker:eT.z.string(),name:eT.z.string(),value:eT.z.number(),change:eT.z.number(),changePercent:eT.z.number(),unit:eT.z.string(),market:eT.z.string(),tickerType:eT.z.string()})}),eU=eT.z.discriminatedUnion("type",[eO]),eD=eT.z.object({prefix:eT.z.string().optional(),prompt:eT.z.string().optional(),label:eT.z.string(),type:eR,icon:eT.z.string().optional(),payload:eU.optional()});eT.z.object({label:eT.z.string(),prompt:eT.z.string().optional(),type:eR,img:eT.z.string().optional(),description:eT.z.string().optional(),prefix:eT.z.string().optional(),payload:eU.optional()});let ez=["en"],eL=[{type:"createImage",prefix:"Draw ",label:"Create Images"},{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}];var eK=s(42557),eB=s(25859);let eH=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,O.j)(z.A("open")),s=(0,A._)(),{user:i}=(0,eK.wV)(),n=(0,ep.useRouter)(),r=(0,b.useCallback)(()=>{if(!i){s("sign_in_redirect",void 0,{location:"edit-image-suggestion-pill"}),n.push("/sign-in");return}s("image_editor_open",void 0,{location:"suggestion-pill"}),t()},[i,t,s,n]);return(0,a.jsxs)(eB.gx,{variant:"secondary",size:"md",shape:"pill",tooltipProps:{delayDuration:100},tooltipContentProps:{side:"bottom",className:"bg-fg-primary text-background"},tooltipContent:i?void 0:e("Sign in to edit images","Sign in to edit images"),onClick:r,children:[(0,a.jsx)(m.mgJ,{size:18,strokeWidth:2,className:"text-secondary"}),(0,a.jsx)("span",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("Edit Image","Edit Image")})]})};var eq=s(50222),eF=s(32507),eG=s(3683);function eW(){let e=(0,A._)(),t=(0,o.aP)(e=>e.projectId),s=(0,o.aP)(e=>e.setProjectId),i=(0,eG.M)(e=>e.loadWorkspace),{t:n}=(0,j.Bd)("base");(0,b.useEffect)(()=>{i(eF.ux)},[i]);let r=(0,b.useCallback)(()=>{e("deepsearch_pill_clicked",void 0,{location:"deepsearch-suggestion-pill",target:"chip"}),s(t===eF.ux?void 0:eF.ux)},[e,t,s]);return(0,a.jsxs)(eB.$n,{variant:"secondary",size:"md",shape:"pill",onClick:r,children:[(0,a.jsx)(eq.A,{size:16,strokeWidth:2,className:"text-secondary"}),n("deep-search","DeepSearch")]})}var eV=s(21782);function e$(e){let{suggestion:t,onClick:s}=e,{label:i}=t,n=(0,b.useCallback)(()=>{s(t)},[s,t]);return(0,a.jsxs)(eB.$n,{size:"md",variant:"secondary",shape:"pill",onClick:n,children:[(0,a.jsx)(eQ,{suggestion:t}),(0,a.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:i})]})}function eY(e){let{suggestions:t,onClick:s,handleSend:i}=e,{user:n}=(0,eK.wV)(),r=(0,P.h)(),l=(0,D.C$)(z.A("isIncognito")),o=!l,d=Math.min(t.length,5)-!!o-!!(n&&!l)-2,c=(0,eV.f)(),u=ez.includes(c),m=r.SHOW_DEEPSEARCH_SUGGESTION_PILL;return(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[m&&(0,a.jsx)(eW,{}),u&&t.slice(0,d).map(e=>{let t=e.type+e.prefix+e.prompt;return(0,a.jsx)(e$,{suggestion:e,onClick:s},t)}),o&&!m&&(0,a.jsx)(eH,{}),(0,a.jsx)(eN.Ph,{handleSend:i})]})})}function eQ(e){let{suggestion:t}=e,[s,i]=(0,b.useState)(!1),[n,r]=(0,b.useState)(!0);return t.icon&&!s?(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)(eJ,{suggestion:t}),(0,a.jsx)("img",{src:t.icon,alt:"".concat(t.type," icon"),className:"me-2 h-[18px] w-[18px] object-contain",onError:()=>i(!0),onLoad:()=>r(!1),style:{display:n?"none":"block"}})]}):(0,a.jsx)(eJ,{suggestion:t})}let eX={className:"text-secondary",strokeWidth:2,size:18};function eJ(e){let{suggestion:t}=e;switch(t.type){case"deepsearch":return(0,a.jsx)(m.Dd5,{...eX});case"brainstorm":return(0,a.jsx)(m.KqI,{...eX});case"analyzeData":case"createReport":return(0,a.jsx)(m.EsT,{...eX});case"createImage":return(0,a.jsx)(m.XGR,{...eX});case"code":return(0,a.jsx)(m.CyN,{...eX});default:return(0,a.jsx)(a.Fragment,{})}}var eZ=s(42151),e0=s(58939),e1=s(76393),e2=s(10463);function e3(e){var t,s,i,n,r,l,o,d,c,u,p,g,h,x,f,v,y,b,w,I,N,S,C;let{suggestion:M}=e,P={type:"finance",label:null!=(f=(o=M.summary).ticker)?f:"",payload:{type:"stockMiniSummary",summary:{ticker:null!=(v=o.ticker)?v:"",name:null!=(y=null==(d=o.stockOverview)?void 0:d.name)?y:"",value:null!=(b=null==(c=o.financeValue)?void 0:c.value)?b:0,change:null!=(w=null==(u=o.financeValue)?void 0:u.change)?w:0,changePercent:null!=(I=null==(p=o.financeValue)?void 0:p.changePercent)?I:0,unit:null!=(N=null==(g=o.financeValue)?void 0:g.unit)?N:"",market:null!=(S=null==(h=o.stockOverview)?void 0:h.market)?S:"",tickerType:null!=(C=null==(x=o.stockOverview)?void 0:x.tickerType)?C:""}}}.payload,{i18n:E}=(0,j.Bd)("finance"),_=null!=(s=P.summary.value)?s:0,A=null!=(i=P.summary.change)?i:0,T=null!=(n=P.summary.changePercent)?n:0,R=(null==(t=M.summary.stockOverview)?void 0:t.currency)||"USD",O=(null!=(l=null!=(r=P.summary.name)?r:P.summary.ticker)?l:"").replace(" Common Stock",""),U=e2.s[P.summary.ticker];return(0,a.jsxs)("div",{className:(0,k.cn)("flex gap-3 px-1 @sm:ps-5 @sm:pe-0 h-10 items-center"),children:[U?(0,a.jsx)("img",{src:U,alt:P.summary.ticker,className:"w-5 h-5 rounded-sm"}):(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8",children:(0,a.jsx)(m.ntg,{className:"w-5 h-5 text-fg-secondary"})}),(0,a.jsxs)("div",{className:"flex-1  gap-1",children:[(0,a.jsx)("span",{className:"text-fg-primary",children:P.summary.ticker})," \xb7"," ",(0,a.jsx)("span",{children:O})," ",(0,a.jsx)("span",{className:"font-semibold",children:function(e,t,s){try{return new Intl.NumberFormat(s,{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}catch(s){return e.toFixed(2)+t}}(_,R,E.language)})," ",(0,a.jsx)(e1.p,{value:A,formatter:e=>e.toFixed(_<1?3:2)})," ",(0,a.jsx)(e1.p,{value:T,formatter:e=>"".concat(e.toFixed(2),"%"),prefix:"(",suffix:")"})]})]})}let e5=(e,t)=>{var s,a;let i="",n=0;for(;n<e.length&&(null==(s=e[n])?void 0:s.toLowerCase())===(null==t||null==(a=t[n])?void 0:a.toLowerCase());)i+=e[n],n++;return i},e4=e=>{let{suggestion:t,search:s,className:i}=e,n=t.text.split(" ").map(e=>({text:e,isHighlighted:!1})),r=s.split(" ");return n=n.map((e,t)=>{if(t>=r.length||!r[t])return e;let s=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:s}}),(0,a.jsx)("div",{className:i,children:n.map((e,t)=>{if(t===r.length-1&&r[t]&&e.text.toLowerCase().includes(r[t])){var s;let i=e5(e.text,r[t]);return(0,a.jsxs)(b.Fragment,{children:[(0,a.jsx)("span",{className:"font-medium text-primary",children:i}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:[null==(s=e.text)?void 0:s.slice(null==i?void 0:i.length),"\xa0"]})]},t)}return e.isHighlighted?(0,a.jsxs)("span",{className:"font-medium text-primary",children:[e.text,"\xa0"]},t):(0,a.jsxs)("span",{className:"text-muted-foreground",children:[e.text,"\xa0"]},t)})})};var e6=s(19841),e8=s(69499),e9=s.n(e8);let e7={},te=e9()(()=>{(0,f.N8)("autocomplete",{type:"suggestion_view",counters:e7}),e7={}},10),tt=e=>{let{suggestions:t,position:s,onPositionChange:i,onPositionSelect:n,highlightText:r,keyboardNavigationEnabled:l=!0,incrementSuggestionsShownCount:o}=e;return(0,b.useEffect)(()=>{let e=null==t?void 0:t.length;if(!e||!l)return;let a=t=>{if("Enter"===t.key&&!t.shiftKey&&void 0!==s){t.preventDefault(),t.stopPropagation(),n(s);return}let a=0;"ArrowDown"===t.key&&(t.preventDefault(),void 0!==s&&(a=(s+1)%e),s===e-1&&(a=void 0)),"ArrowUp"===t.key&&(t.preventDefault(),void 0!==s&&(a=(s-1)%e),0===s&&(a=void 0),void 0===s&&(a=e-1)),("ArrowUp"===t.key||"ArrowDown"===t.key)&&i(a)};return document.addEventListener("keydown",a,{capture:!0}),()=>document.removeEventListener("keydown",a,{capture:!0})},[s,i,t,n,l]),(0,a.jsx)("ul",{className:"@sm:-mt-1.5 pb-2 flex flex-col overflow-hidden bg-background min-h-36",onMouseLeave:()=>{i(void 0)},children:t.map((e,t)=>(0,a.jsx)("li",{dir:"auto",className:(0,k.cn)("cursor-pointer rounded-xl",s===t?"sm:border-input-border-focus sm:bg-button-ghost-hover":""),onMouseMove:()=>{t!==s&&i(t)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{n(t)},children:(0,a.jsx)(ts,{suggestion:e,highlightText:r,onReady:o})},JSON.stringify(e)))})};function ts(e){let{suggestion:t,highlightText:s,onReady:i}=e;return((0,b.useEffect)(()=>{null==i||i();let e=e7[t.type]||0;e7[t.type]=e+1,te()},[i,t]),"stock"===t.type)?(0,a.jsx)(e3,{suggestion:t}):"project"===t.type?(0,a.jsx)(ti,{icon:(0,a.jsx)(e0.Oh,{icon:t.project.icon,className:"h-5 w-5 "}),mobileIcon:!0,children:(0,a.jsx)("div",{className:"truncate",children:t.project.name})}):"conversation"===t.type?(0,a.jsx)(ti,{icon:(0,a.jsx)(m.MYu,{className:"h-5 w-5"}),children:(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("span",{children:t.conversation.title}),(0,a.jsx)(e6.D,{conversation:t.conversation,className:"ms-1.5 text-fg-tertiary hidden @sm:block align-baseline"})]})}):"math"===t.type?(0,a.jsx)(ti,{icon:(0,a.jsx)(m.tEU,{className:"h-5 w-5"}),children:(0,a.jsx)("div",{className:"truncate",children:t.result})}):"answer"===t.type?(0,a.jsx)(ti,{icon:(0,a.jsx)(m.Fl4,{className:"h-5 w-5"}),children:(0,a.jsx)("div",{className:"truncate text-fg-primary",children:t.text})}):(0,a.jsx)(ti,{icon:(0,a.jsx)(eZ.A,{className:"h-5 w-5"}),children:(0,a.jsx)(e4,{className:"flex-1",suggestion:t,search:s})})}function ta(e){let{children:t}=e;return(0,a.jsx)("div",{className:"flex gap-3 px-1 @sm:ps-5 @sm:pe-0 h-10 items-center",style:{maskImage:"linear-gradient(to right, rgba(0,0,0,1) 90%, rgba(0,0,0,0) 97%)"},children:t})}function ti(e){let{icon:t,children:s,mobileIcon:i}=e;return(0,a.jsxs)(ta,{children:[(0,a.jsx)("div",{className:(0,k.cn)(i?"block":"hidden","@sm:block justify-start text-fg-secondary shrink-0 grow-0"),children:t}),(0,a.jsx)("div",{className:"flex-auto min-w-0 overflow-hidden truncate",children:s})]})}var tn=s(44600);function tr(e){let{className:t,handleSend:s,position:i,setPosition:n,incrementSuggestionsShownCount:r=()=>{},focusTextArea:l=()=>{},disablePills:d=!1}=e,c=(0,P.h)(),{push:u}=(0,eu.wK)(),{t:m}=(0,j.Bd)("chat"),p=(0,o.aP)(z.A("setProjectId")),g=(0,o.aP)(z.A("conversationId"))||"no_conversation_id",h=(0,o.aP)(e=>e.queryByConversationId[g])||"",x=(0,b.useCallback)(e=>{let{idsetQueryByConversationId:t}=o.aP.getState();t(e,g)},[g]),v=(0,A._)(),[w,I]=(0,b.useState)(h),N=(0,tn.Pt)(w),S=(0,b.useRef)(""),C=e=>{S.current=e,x(e)};(0,b.useEffect)(()=>{h||n(void 0),(S.current!==h||""===h)&&I(h)},[n,h]);let M=!!h,E=!d&&(!M||!(null==N?void 0:N.length)),_=function(){var e;let t=null==(e=(0,P.h)().EXTRA_SUGGESTIONS.value)?void 0:e.extraSuggestions;return(0,b.useMemo)(()=>{if(t)return[...Array.isArray(t)?t.map(e=>eD.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],...eL];return eL},[t])}(),T=(0,b.useCallback)(e=>{if(e.prefix){var t;let s="".concat(null==(t=e.prefix)?void 0:t.trim()).concat(h?":":"");(null==h?void 0:h.includes(s))||(x("".concat(s," ").concat(h)),null==l||l())}else e.prompt&&s({query:e.prompt,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},isPreset:!!c.SUGGESTIONS_USE_CACHE});v("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[x,h,s,c.SUGGESTIONS_USE_CACHE,v,l]),R=!h.includes("\n")&&h.length<75;return(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"w-full flex justify-center",children:(0,a.jsxs)("div",{className:(0,k.cn)("z-10 w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar will-change-[mask-image] @sm:[mask-image:none] min-h-10",ek.Q,t),children:[(0,a.jsx)("div",{className:(0,k.cn)("absolute","bg-background w-full",ek.Q,"transition-opacity",N&&0!==N.length?"opacity-100":"opacity-0 pointer-events-none"),children:(0,a.jsx)(tt,{suggestions:N,position:i,onPositionChange:e=>{if(n(e),void 0===e)C(w);else{let s=N[e];if(((null==s?void 0:s.type)==="search"||(null==s?void 0:s.type)==="llm")&&C(s.text),(null==s?void 0:s.type)==="stock"){var t;C(null!=(t=s.summary.ticker)?t:"")}(null==s?void 0:s.type)==="math"&&C(s.result.toString())}},onPositionSelect:e=>{let t=N[e];if(t){if(v("suggestion_selected",void 0,{suggestionType:t.type,position:String(i),location:"chat-autocomplete-suggestions",searchText:w,text:"llm"===t.type||"search"===t.type||"answer"===t.type?t.text:""}),(0,f.N8)("chat-autocomplete-suggestions",{type:"suggestion_selected",suggestionType:t.type}),"search"===t.type||"llm"===t.type?s({query:t.text,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}):"answer"===t.type&&s({query:m("validate-answer-message",'{{query}}\n\nHot take: "{{answer}}"\n\nExplain more',{query:w,answer:t.text}),toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}),(null==t?void 0:t.type)==="stock"){var a;s({query:null!=(a=t.summary.ticker)?a:"",toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}})}(null==t?void 0:t.type)==="project"&&p(t.project.workspaceId),(null==t?void 0:t.type)==="conversation"&&u({page:"chat",conversationId:t.conversation.conversationId,temporary:!1}),(null==t?void 0:t.type)==="math"?(C(t.result.toString()),I(t.result.toString())):(C(""),I("")),n(void 0)}},highlightText:w,keyboardNavigationEnabled:R,incrementSuggestionsShownCount:r})}),E&&(0,a.jsx)(eY,{suggestions:_,onClick:T,handleSend:s})]})},"suggestions")}var tl=s(27636);let to=e=>{let{onHide:t}=e,s=(0,A._)(),i=(0,H.Di)(),{t:n}=(0,j.Bd)("tasks"),{taskPresets:r}=(0,tl.hB)(),l=(0,e_.d)(z.A("setCreateDialogIsOpen")),o=(0,e_.d)(z.A("setTaskToEdit")),[d,c]=(0,b.useState)(tc(r)[0]),u=(0,b.useCallback)(()=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(d)},[d,l,o,s]),g=(0,b.useCallback)(e=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(e),c(e)},[l,o,s]);return d?(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,a.jsxs)("div",{className:(0,k.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!i}),children:[(0,a.jsx)(td,{value:d,onValueChange:g}),(0,a.jsxs)(p.$n,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:u,className:"font-semibold",children:[(0,a.jsx)(m.mdw,{size:14}),i?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,a.jsx)(p.gx,{tooltipContent:(0,a.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:t,children:(0,a.jsx)(m.X,{size:14})})]}):null};function td(e){let{value:t,onValueChange:s}=e,[i,n]=(0,b.useState)(!1),{taskPresets:r}=(0,tl.hB)(),{t:l}=(0,j.Bd)("tasks"),o=(0,H.Di)(),d=(0,b.useCallback)(e=>{n(e)},[]);return(0,a.jsxs)(V.rI,{open:i,onOpenChange:d,children:[(0,a.jsx)(V.ty,{asChild:!0,children:(0,a.jsxs)(p.$n,{className:"flex items-center font-semibold",variant:"text","aria-label":l("selected-day.label","Selected day"),size:"sm",children:[t.cta||t.name,(0,a.jsx)(m.yQN,{size:14,className:(0,k.cn)("transition-transform duration-200",{"rotate-180":i})})]})}),(0,a.jsx)(V.SQ,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,k.cn)({"w-[500px]":!o}),children:tc(r).map(e=>(0,a.jsxs)(V._2,{onSelect:()=>{s(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,a.jsx)(m.c_$,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function tc(e){for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}let tu=()=>(0,a.jsx)(a.Fragment,{});var tm=s(66570),tp=s(59109),tg=s(56907),th=s(95158),tx=s(94553),tf=s(85666),tv=s(50626),ty=s(80832),tb=s(97533),tj=function(e){return e.PAST_30_DAYS="past-30-days",e.THIS_MONTH="this-month",e.THIS_YEAR="this-year",e.PAST_3_MONTHS="past-3-months",e.PAST_6_MONTHS="past-6-months",e}({});let tw=e=>{let{isError:t,title:s,timeRangeOptions:i,selectedTimeRange:n,onTimeRangeChange:r,children:l}=e,{t:o}=(0,j.Bd)("base"),[d,c]=(0,b.useState)(!1),u=(0,b.useCallback)(e=>o("team-insights.time-range.".concat(e),e),[o]),p=(0,b.useMemo)(()=>u(n),[n,u]);return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-fg-secondary",children:s}),(null==i?void 0:i.length)?(0,a.jsxs)(V.rI,{open:d,onOpenChange:c,children:[(0,a.jsxs)(V.ty,{className:"text-xs text-fg-tertiary flex items-center gap-1 focus:outline-none",children:[(0,a.jsx)("span",{className:"whitespace-nowrap",children:p}),(0,a.jsx)(m.D3D,{className:(0,k.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":d})})]}),(0,a.jsx)(V.SQ,{sideOffset:8,align:"end",className:"min-w-40",children:i.map(e=>(0,a.jsxs)(V._2,{onSelect:()=>null==r?void 0:r(e),className:"flex items-center gap-2 justify-between",children:[(0,a.jsx)("span",{children:u(e)}),e===n&&(0,a.jsx)(m.Srz,{className:"text-fg-primary size-4"})]},e))})]}):(0,a.jsx)("span",{className:"text-xs text-fg-tertiary",children:p})]}),(0,a.jsx)("div",{className:"flex flex-col justify-between mt-3 w-full h-12",children:t?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center h-full border border-border-l1 rounded-2xl",children:(0,a.jsx)("span",{className:"text-fg-tertiary text-sm",children:o("team-insights.error-loading-data","Could not load data")})},"error"):l})]})},tI=e=>{switch(e){case"past-30-days":return(0,tx.e)((0,tf.R)(),29).toISOString();case"this-month":return(0,tv.w)((0,tf.R)()).toISOString();case"this-year":return(0,ty.D)((0,tf.R)()).toISOString();case"past-3-months":return(0,tv.w)((0,tb.a)((0,tf.R)(),2)).toISOString();case"past-6-months":return(0,tv.w)((0,tb.a)((0,tf.R)(),5)).toISOString()}};var tN=s(80226),tk=s(48589);let tS=()=>{let{t:e}=(0,j.Bd)("base"),{currentTeam:t,isSwitchingTeam:s}=(0,ew.hd)(),[i,n]=(0,_.M)("team-insights.messages-counters-time-range",tj.THIS_MONTH),r=(0,b.useMemo)(()=>tI(i),[i]),{data:l,isFetching:o,isError:d}=(0,tg.IT)({queryKey:["team-stats",null==t?void 0:t.teamId,r],queryFn:async()=>th.xT.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==t?void 0:t.teamId)&&!s,staleTime:1/0}),c=(0,b.useMemo)(()=>o||s,[o,s]),u=(0,tk.o)(c,300,[c]),m=(0,b.useMemo)(()=>[{count:parseInt(u?"0":(null==l?void 0:l.messageCount)||"0"),label:e("team-insights.you","You")},{count:parseInt(u?"0":(null==l?void 0:l.totalMessages)||"0"),label:e("team-insights.team","Team")}],[l,e,u]);return(0,a.jsx)(tw,{title:e("team-insights.messages","Messages"),timeRangeOptions:[tj.THIS_MONTH,tj.PAST_3_MONTHS,tj.PAST_6_MONTHS,tj.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:d,children:m.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-fg-secondary",children:e.label}),(0,a.jsx)(v.N,{mode:"wait",initial:!1,children:c?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-6 flex items-center justify-end",children:(0,a.jsx)(tN.E,{className:(0,k.cn)("h-2 w-10 rounded-sm",{"w-20":1===t})})},"loading"):(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"h-6",children:(0,a.jsx)(tp.Ay,{value:e.count,className:"text-sm font-semibold"})},"count")})]},e.label))})},tC=()=>{let{t:e}=(0,j.Bd)("base"),{currentTeam:t,isSwitchingTeam:s}=(0,ew.hd)(),[i,n]=(0,_.M)("team-insights.sharing-leaderboard-time-range",tj.THIS_MONTH),r=(0,b.useMemo)(()=>tI(i),[i]),{data:l,isFetching:o,isError:d}=(0,tg.IT)({queryKey:["team-stats",null==t?void 0:t.teamId,r],queryFn:async()=>th.xT.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==t?void 0:t.teamId)&&!s,staleTime:1/0}),c=(0,b.useMemo)(()=>o||s,[o,s]),u=(0,b.useMemo)(()=>{var e,t;let s=Array.from({length:3}).map(()=>({name:" - ",shareLinkCount:0}));return[...(null==l||null==(t=l.topUsers)||null==(e=t.map(e=>{var t,s;return{name:"".concat(null==(t=e.user)?void 0:t.givenName," ").concat(null==(s=e.user)?void 0:s.familyName),shareLinkCount:parseInt(e.shareLinkCount||"0")}}))?void 0:e.sort((e,t)=>t.shareLinkCount-e.shareLinkCount))||[],...s].slice(0,3)},[l]);return(0,a.jsx)(tw,{title:e("team-insights.top-sharers","Top sharers"),timeRangeOptions:[tj.THIS_MONTH,tj.PAST_3_MONTHS,tj.PAST_6_MONTHS,tj.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:d,children:u.map((t,s)=>{let{name:i,shareLinkCount:n}=t;return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full h-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,a.jsx)("span",{className:"text-fg-secondary text-[12px] w-3 text-start",children:s+1}),(0,a.jsx)(v.N,{initial:!1,mode:"wait",children:c?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tN.E,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,a.jsx)(y.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-primary text-xs truncate",children:i},"name")})]}),(0,a.jsx)(v.N,{initial:!1,mode:"wait",children:c?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tN.E,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,a.jsx)(y.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-xs text-fg-tertiary whitespace-nowrap",children:e("team-insights.share-count","{{count}} shared",{count:n})},"count")})]},"".concat(s,"-").concat(i))})})};var tM=s(61884),tP=s(16506),tE=s(14100),t_=s(73755),tA=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.VERY_HIGH=4]="VERY_HIGH",e}(tA||{});let tT=()=>{let{t:e}=(0,j.Bd)("base"),{resolvedTheme:t}=(0,tP.D)(),{currentTeam:s,isSwitchingTeam:i}=(0,ew.hd)(),n=(0,b.useMemo)(()=>tI(tj.PAST_30_DAYS),[]),{data:r,isLoading:l,isError:o}=(0,tg.IT)({queryKey:["team-stats",null==s?void 0:s.teamId,n],queryFn:async()=>th.xT.grokForTeamsGetTeamStats({fromTime:n,maxEntries:3}),enabled:!!(null==s?void 0:s.teamId)&&!i,staleTime:1/0}),d=(0,b.useMemo)(()=>{let e=Array.from({length:30}).map((e,t)=>{var s,a,i;let l=new Date(n);return l.setDate(l.getDate()+t),parseInt((null==r||null==(i=r.teamStats)||null==(a=i.stats)||null==(s=a.find(e=>e.startTime&&(0,tE.r)(e.startTime,l)))?void 0:s.totalMessages)||"0")}),t=e.filter(e=>e>0),s=[0,1,20,50];if(t.length>0){let e=[...t].sort((e,t)=>e-t),a=e[Math.floor(.25*e.length)]||1;s=[0,a,e[Math.floor(.5*e.length)]||1,e[Math.floor(.75*e.length)]||1]}return Array.from({length:30}).map((t,a)=>{let i=new Date(n);i.setDate(i.getDate()+a);let r=e[a]||0,l=0===r?0:r<=s[1]?1:r<=s[2]?2:r<=s[3]?3:4;return{date:i.toISOString(),totalMessages:r,colorLevel:l}})},[n,r]),c=(0,b.useMemo)(()=>l||i,[l,i]);return(0,a.jsx)(tw,{title:e("team-insights.team-usage","Team usage"),selectedTimeRange:tj.PAST_30_DAYS,isError:o,children:(0,a.jsx)("div",{className:"grid grid-cols-12 content-between w-full h-full max-w-[260px] place-items-stretch",children:d.map((s,i)=>(0,a.jsxs)(tM.m_,{disableHoverableContent:!0,delayDuration:0,children:[(0,a.jsx)(tM.k$,{asChild:!0,children:(0,a.jsx)("div",{className:(0,k.cn)("group w-full h-full flex items-center justify-center",{"cursor-pointer":!c}),children:(0,a.jsx)("div",{className:(0,k.cn)("duration-200 transition-all",{"group-hover:scale-125":!c}),children:(0,a.jsx)("div",{className:(0,k.cn)("w-3 h-3 border border-border-l1 rounded-[4px] transition-all duration-500",{"animate-pulse":c}),style:{backgroundColor:tR[t||"dark"][c?0:s.colorLevel],animationDelay:"".concat(.03*i,"s"),animationDuration:"1s"}})})})}),!c&&(0,a.jsx)(tM.ZI,{children:(0,a.jsx)("span",{className:"text-xs",children:s.totalMessages?e("team-insights.day-with-activity","{{count}} messages on {{date}}",{date:(0,t_.GP)(s.date,"MMMM do"),count:s.totalMessages}):e("team-insights.day-without-activity","No activity on {{date}}",{date:(0,t_.GP)(s.date,"MMMM do")})})})]},s.date))})})},tR={dark:{0:"#1D1E20",1:"#242628",2:"#3E3F41",3:"#57595B",4:"#B5B5B5"},light:{0:"#F3F3F1",1:"#BFBEBD",2:"#9F9E9D",3:"#646362",4:"#4B4A48"}};var tO=s(25901);let tU=e=>{let{className:t}=e;return(0,a.jsx)(tO.x,{transition:{duration:.2,ease:"easeInOut"},children:(0,a.jsx)("div",{className:(0,k.cn)("@container/team-insights w-full",t),children:(0,a.jsxs)("div",{className:"grid grid-cols-1 @[500px]/team-insights:grid-cols-2 @[700px]/team-insights:grid-cols-3 w-full",children:[(0,a.jsx)("div",{className:"hidden @[500px]/team-insights:block pl-4 pr-6",children:(0,a.jsx)(tT,{})}),(0,a.jsxs)("div",{className:"hidden @[700px]/team-insights:block px-6 relative",children:[(0,a.jsx)(tS,{}),(0,a.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]}),(0,a.jsxs)("div",{className:"pr-4 pl-6 relative",children:[(0,a.jsx)(tC,{}),(0,a.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]})]})})})};var tD=s(68217);let tz=e=>{let{className:t}=e,{t:s}=(0,j.Bd)("base"),{isSwitchingTeam:i}=(0,ew.hd)(),{results:n,isFetching:r,isError:l,isLoadingTeamMembers:o,handleNavigateToSharedConversation:d}=(0,tD.K)({pageSize:60,orderBy:"viewCount"}),c=(0,b.useMemo)(()=>r||i,[r,i]);return(0,a.jsx)(tO.x,{transition:{duration:.2,ease:"easeInOut"},children:(0,a.jsxs)("div",{className:(0,k.cn)("@container/shared-with-me w-full",t),children:[(0,a.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-fg-secondary",children:s("team-insights.shared-with-me","Shared with me")}),(0,a.jsx)(eu.N_,{route:{page:"history",tab:"shared-with-me"},className:"text-xs text-fg-tertiary hover:text-fg-secondary transition-all",children:s("team-insights.see-all","See all")})]}),l?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,a.jsx)("span",{className:"text-fg-tertiary text-sm",children:s("team-insights.error-loading-data","Could not load data")})},"error"):(0,a.jsx)("div",{className:"px-4 mt-4 grid grid-cols-1 @[500px]/shared-with-me:grid-cols-3 w-full gap-4",children:(0,a.jsx)(v.N,{initial:!1,children:Array.from({length:3}).map((e,t)=>{let s=n[t];return(0,a.jsx)(tL,{shareLink:s,isLoading:c,isLoadingTeamMembers:o,onClick:s?()=>d(s.shareLinkId):void 0},"shared-with-me-".concat(t))})})})]})})},tL=e=>{var t,s,i;let{shareLink:n,isLoading:r,isLoadingTeamMembers:l,onClick:o}=e,d=(0,b.useMemo)(()=>!r&&!n,[r,n]);return(0,a.jsxs)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:(0,k.cn)("p-3 flex flex-col gap-2 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative",{"cursor-pointer hover:bg-surface-l2":!!n&&!r,"bg-transparent":d}),children:[(0,a.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,a.jsx)(v.N,{mode:"wait",initial:!1,children:r?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tN.E,{className:"h-2 w-20 rounded-sm"})},"loading"):n&&(0,a.jsx)(y.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary truncate",children:(null==(t=n.conversation)?void 0:t.title)||"Untitled Conversation"},"title")})}),(0,a.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,a.jsx)(v.N,{mode:"wait",initial:!1,children:r||l?(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(tN.E,{className:"h-2 w-16 rounded-sm"})},"loading-user"):n&&(0,a.jsx)(y.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:"".concat((null==n||null==(s=n.user)?void 0:s.givenName)||""," ").concat((null==n||null==(i=n.user)?void 0:i.familyName)||"")},"user")})}),(0,a.jsx)(v.N,{initial:!1,children:d&&(0,a.jsx)(y.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,k.cn)("absolute inset-0 flex justify-center items-center"),children:(0,a.jsx)("div",{className:"w-10 border-b border-border-l1"})},"empty-state")})]})};var tK=s(91102);let tB=0;function tH(){let{user:e}=(0,ei.useSession)(),{os:t}=(0,tK.c)(),s=(0,ep.useRouter)(),i=(0,A._)(),n=(0,H.Di)(),{push:r}=(0,eu.wK)(),[l,o]=(0,_.M)("visited-imagine",!1),[d,c]=(0,_.M)("imagine-banner-impressions",0);(0,b.useEffect)(()=>{Date.now()<tB||(tB=Date.now()+12e4,c(e=>e+1))},[]);let{resolvedTheme:u}=(0,tP.D)(),p=(0,b.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),r({page:"imagine"})},[r,i]),g=(0,b.useCallback)(e=>{e.stopPropagation(),o(!0),i("imagine_banner_dismissed","imagine-banner",{location:"imagine-banner"})},[o,i]);(0,b.useEffect)(()=>{i("imagine_banner_impression","imagine-banner",{location:"imagine-banner"})},[]);let h=(0,b.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let a=new URLSearchParams({return_to:"/imagine"}).toString();i("sign_up_redirect",t,{location:"imagine-banner",os:t}),s.push("/sign-up".concat(a?"?".concat(a):""))},[i,t,s]),x=(0,b.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let a=new URLSearchParams({return_to:"/imagine"}).toString();i("sign_in_redirect",t,{location:"imagine-banner",os:t}),s.push("/sign-in".concat(a?"?".concat(a):""))},[i,t,s]),{t:f}=(0,j.Bd)("imagine");return(0,a.jsxs)("div",{className:(0,k.cn)("relative dark max-w-[480px] w-full m-10",{"m-0 mb-24 mx-2":n}),children:[(0,a.jsxs)("div",{className:(0,k.cn)("flex dark flex-col items-center justify-center w-full rounded-3xl overflow-hidden  cursor-pointer bg-surface-l1 ",{"border-2 border-color-surface-l1":"dark"===u}),onClick:p,children:[(0,a.jsx)("div",{className:"relative w-full h-[88px] overflow-hidden",children:(0,a.jsx)(q.default,{src:"/imagine-banner.png",alt:"",fill:!0,className:"object-cover"})}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between px-4 pt-0 pb-3 w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"dark text-primary text-sm font-bold m-0 p-0",children:f("imagine.banner.title","Imagine Anything")}),(0,a.jsx)("p",{className:"dark text-fg-secondary text-sm m-0 p-0 single line-clamp-1 break-all",children:f("imagine.banner.subtitle","Generate images and videos with Grok Imagine.")})]}),e&&(0,a.jsx)(eB.$n,{variant:"secondary",shape:"pill",size:"md",className:"dark font-bold text-primary",onClick:p,children:f("imagine.banner.button","Go")})]}),!e&&(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-start justify-start mb-3",children:[(0,a.jsxs)(eB.$n,{className:"font-semibold text-sm",variant:"primary",size:"sm",shape:"pill",onClick:h,children:[(0,a.jsx)(m.KJW,{size:14}),f("Sign up","Sign up")]}),(0,a.jsx)(eB.$n,{className:"font-semibold text-sm",variant:"secondary",size:"sm",shape:"pill",onClick:x,children:f("Sign in","Sign in")})]})]}),(0,a.jsx)(eB.$n,{variant:"tertiary",shape:"circle",size:"xs",className:"dark font-bold text-primary absolute -top-2 -end-2 bg-surface-l2 hover:bg-surface-l4",onClick:g,"aria-label":"Close",children:(0,a.jsx)(m.uv5,{className:"size-4"})})]})}function tq(){let{t:e}=(0,j.Bd)("chat"),{isSuperGrokUser:t,isEnterpriseUser:s,isSuperGrokProUser:i,bestSubscription:n,isPending:r}=(0,ey.Q2)(),l=(0,e_.d)(z.A("userActiveTasks")),d=(0,e_.d)(z.A("initialized")),c=(0,b.useRef)(""),{signInWithReturnTo:u}=(0,el.o)(),p=(0,A._)(),g=(0,P.h)(),{handleVoiceModeEnter:x}=(0,en.F)({location:"chat-new"}),w=(0,o.aP)(z.A("establishNewConversation")),I=(0,D.C$)(z.A("isIncognito")),N=(0,o.aP)(z.A("activeModelId")),S=(0,o.aP)(z.A("defaultAnonModelId")),C=(0,o.aP)(z.A("defaultFreeModelId")),E=(0,o.aP)(z.A("defaultProModelId")),T=(0,o.aP)(z.A("setDefaultAnonModelId")),U=(0,o.aP)(z.A("setDefaultFreeModelId")),L=(0,o.aP)(z.A("setDefaultProModelId")),K=(0,o.aP)(z.A("outputMode")),B=(0,o.aP)(z.A("reasoningMode")),q=(0,o.aP)(z.A("setReasoningMode")),F=(0,o.aP)(z.A("conversationId")),G=(0,o.aP)(z.A("conversationId"))||"no_conversation_id",W=(0,o.aP)(e=>e.queryByConversationId[G])||"",V=(0,h.c)(),[$]=(0,_.M)("visited-imagine",!1),[Y]=(0,_.M)("imagine-banner-impressions",0),Q=!V&&g.SHOW_IMAGINE_BANNER&&Y<=10&&!$&&0===W.length,{sessionStartTime:X,conversationDepth:J}=(0,eP.T)(F),Z=(0,H.Di)(),ee=(0,R.x)(z.A("listByConversationId")),et=(0,R.x)(z.A("attachListByConversationId")),es=(0,O.j)(z.A("isOpen")),ea=(0,b.useMemo)(()=>ee.no_conversation_id||[],[ee]),er=(0,b.useMemo)(()=>et.no_conversation_id||[],[et]),eo=(0,eC.$E)(),ed=(0,H.Di)(),ec=(0,eb.n)(),eu=(0,b.useMemo)(()=>ec&&!W&&!I,[ec,W,I]),em=(0,b.useMemo)(()=>!I&&(ea.length>0&&!!ea.every(e=>e.file.type.includes("image"))||(null==er?void 0:er.length)>0&&!!er.every(e=>e.mimeType.includes("image"))),[ea,er,I]),ep=(0,b.useMemo)(()=>!I&&g.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS&&(ea.length>0&&!!ea.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==er?void 0:er.length)>0&&!!er.every(e=>e.mimeType.includes("csv"))),[ea,er,g.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS,I]),[ej,ew]=(0,b.useState)(!1);(0,b.useEffect)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;t=Number(t),g.REPLACE_HOME_PILLS_WITH_TASKS&&0===l.length&&t<2&&!ec?ew(!0):ew(!1)},[g.REPLACE_HOME_PILLS_WITH_TASKS,l.length,ec]);let eT=(0,b.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),ew(!1)},[]),eR=(0,M.L)(),eO=(0,ei.useSession)().user;(0,b.useEffect)(()=>{let e=D.C$.getState();g.NEW_CHAT_ALWAYS_AUTO&&e.userSettings.preferences.useModelModeSelector3&&o.aP.getState().setModelMode("auto")},[]);let eU=(0,b.useRef)(null),eD=(0,b.useCallback)(()=>{var e;null==(e=eU.current)||e.focus()},[eU]);(0,ev.v)(ef.Ib,eD,[]);let{handleKeyDown:ez,consumeCompositionTimeMs:eL,consumeBackspaceCount:eK,consumeAvgKeystrokeLatency:eB,consumeKeystrokeCount:eH,position:eq,setPosition:eF,consumePosition:eG,consumeTypeaheadReqCount:eW,incrementTypeaheadReqCount:eV,incrementSuggestionsShownCount:eY,consumeSuggestionsShownCount:eQ}=(0,eS.T)(),eX=(0,b.useCallback)(e=>{let{query:t,fileAttachmentIds:s,webpageUrls:a,toolOverrides:i,isPreset:r,workspaceIds:l,persona:d,isIncognitoOverride:c,disableMemory:m}=e;if(!t)return Promise.resolve(!1);if(!eO&&(!g.ENABLE_ANON_USERS||eo.includes(N)))return p("sign_in","chat-new",{location:"chat-new"}),u(t,B),Promise.resolve(!1);let h=D.C$.getState(),x=eG(),v=i;tn.jp.getState().config.enabled&&-1!==x&&void 0!==x&&!i&&(v={webSearch:!0});let y=o.aP.getState(),b=(0,eE.m)({chatPageState:{activeModelId:N,modelMode:y.modelMode,outputMode:K,reasoningMode:B},query:t,fileAttachmentIds:s,webpageUrls:a,location:"chat-new",personalityId:h.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:X,conversationDepth:J,isMobile:Z,bestSubscription:n,user:!!eO,compositionTime:eL(),backspaceCount:eK(),avgKeystrokeLatency:eB(),keystrokeCount:eH(),position:x,typeaheadRequestCount:eW(),suggestionsShownCount:eQ(),workspaceCount:(null==l?void 0:l.length)||0,toolOverrides:v,suggestionsSource:g.ENABLE_LLM_SUGGESTIONS?"grok":"bing"});return p("send_query","",b),eR().then(()=>((0,tm.Lc)(),!!w({message:t,fileAttachmentIds:s,webpageUrls:a,toolOverrides:v,temporary:null!=c?c:I,isPreset:r,persona:d,enableRetries:g.ENABLE_AUTO_STREAM_RETRY,ff:g,workspaceIds:l,disableMemory:m}).catch((0,f.HX)("chat-new:establishNewConversation"))))},[N,eO,g,p,I,K,B,eo,eR,w,eB,eK,eL,eH,eG,eQ,eW,u,J,Z,X,n]),{modelById:eJ,defaultAnonModelId:eZ,defaultFreeModelId:e0,defaultProModelId:e1,isPending:e2}=(0,eC.GB)(),e3=(0,o.aP)(z.A("setActiveModelId")),e5=(0,o.aP)(z.A("setModelMode"));(0,b.useEffect)(()=>{if(e2||r&&eO)return;let e=new URLSearchParams(location.search),a=e.get("q"),n=e.get("reasoningMode"),l=e.get("fileid"),o=location.hash===eA.oE;if(E!==e1&&(s||t||i)&&e1&&eJ[e1]){L(e1),e3(e1);return}if(C!==e0&&eO&&e0&&eJ[e0]){U(e0),e3(e0);return}if(S!==eZ&&eZ&&eJ[eZ]){T(eZ),e3(eZ);return}if(n){let e=eM.TM.parse(n);e&&q(e)}a&&!c.current&&(eX({query:a,fileAttachmentIds:l?[l]:void 0,webpageUrls:[],isIncognitoOverride:o,disableMemory:!0}).catch(e=>{(0,f.vV)("chat-new:mount:handleSend",e)}),c.current="auto-start")},[e2,r]);let e4=(0,b.useCallback)(t=>{let{query:s,parentQuotedText:a,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,isPreset:l,persona:o}=t;if(o){let t=(0,eN.pL)(o.personaId,e);t.modelMode&&e5(t.modelMode)}eX({query:s,parentQuotedText:a,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,persona:o,isPreset:l}).catch(e=>{(0,f.vV)("chat-new:handleClickSuggestion",e)})},[eX,e5,e]),e6=(0,b.useCallback)(()=>{let t=[...ea.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...er.map(e=>e.assetId)];eX({query:e("create-report-prompt","Create a report"),fileAttachmentIds:t}).catch(e=>{(0,f.vV)("chat-new:handleClickCreateReport",e)})},[eX,ea,er,e]);return(0,b.useEffect)(()=>{(0,tm.b2)()},[]),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:[g.SHOW_GROK_4_PROMOTION_DIALOG&&(0,a.jsx)(tu,{}),(0,a.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate transition-transform",{"-translate-y-20":ec&&!ed}),children:[(0,a.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",ek.Q),children:[(0,a.jsx)(eI,{height:64,width:320}),ed&&(0,a.jsx)(v.N,{mode:"wait",initial:!1,children:eu?(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",ek.Q),children:(0,a.jsx)(tU,{className:"w-full my-6"})},"teams-ui"):(0,a.jsx)(tr,{className:(0,k.cn)("overflow-visible @sm:invisible",I&&"invisible"),handleSend:e4,position:eq,setPosition:eF,incrementTypeaheadReqCount:eV,incrementSuggestionsShownCount:eY,focusTextArea:eD,disablePills:ec})})]}),(0,a.jsxs)("div",{className:(0,k.cn)("absolute bottom-0 mx-auto inset-x-0",ek.Q,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,a.jsxs)("div",{className:(0,k.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,a.jsx)(eh.s,{className:"mt-2",textAreaClassName:"min-h-14 pt-5 my-0 mb-5",placeholder:e("query-bar-placeholder.1","What do you want to know?"),onQuery:eX,onFrontPage:!es,ref:eU,isIncognito:I,enableVoiceMode:!0,onKeyDown:ez,onVoiceModeEnter:x},"query-bar"),(0,a.jsxs)(v.N,{mode:"wait",initial:!1,children:[em&&!I&&(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,a.jsxs)(eg.R,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,a.jsx)(m.mgJ,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit"),ep&&!I&&(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,a.jsx)(e$,{suggestion:{type:"createReport",label:e("create-report","Create Report")},onClick:e6})},"edit"),Q?(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",transition:{duration:.1},exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:I}),children:(0,a.jsx)(tH,{})},"imagine-banner"):d&&!ed&&(ej?(0,a.jsx)(y.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:I}),children:(0,a.jsx)(to,{onHide:eT})},"task-pill"):!ed&&!em&&!ep&&(eu?(0,a.jsxs)(y.P.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",ek.Q),children:[(0,a.jsx)(tU,{className:"w-full mt-10"}),(0,a.jsx)(tz,{className:"w-full mt-10 mb-6"})]},"teams-ui"):(0,a.jsx)(tr,{className:(0,k.cn)("hidden @sm:block overflow-visible",I&&"invisible"),handleSend:e4,position:eq,setPosition:eF,incrementTypeaheadReqCount:eV,incrementSuggestionsShownCount:eY,focusTextArea:eD,disablePills:ec||Q})))]})]}),eO?null:(0,a.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,a.jsx)(j.x6,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,a.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,a.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]}),(0,a.jsx)(ex.tN,{})]})}var tF=s(48992),tG=s(36401);function tW(e){let{conversationIsLoading:t,conversationError:s,optimisticConversationId:i,conversationId:n,conversation:r}=e,l=(0,Q.K)(),d=(0,o.aP)(z.A("conversationMode"));return((0,b.useEffect)(()=>{(null==r?void 0:r.conversationId)&&U.A3.getState().loadInitialResponses(r.conversationId).then(e=>{var t;let s=o.aP.getState();if(s.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,tF.Mb)(e);if(!t)return void s.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){s.setLastMessageId(t.parentResponseId),s.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){s.setLastMessageId(t.parentResponseId),s.setOptimisticMessageId(t.responseId);return}s.setLastMessageId(t.responseId)}}).catch(e=>{l("chat-page:loadInitialResponses",e)})},[null==r?void 0:r.conversationId]),i)?(0,a.jsx)(tG.T,{conversationId:i,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:t,conversationError:s,enableVoiceMode:!0},"voice"===d?"voice-chat-interaction":"chat-interaction"):n?(0,a.jsx)(tG.T,{conversationId:n,conversation:r||void 0,isOptimisticConversation:!1,conversationIsLoading:t,conversationError:s,enableVoiceMode:!0},"chat-interaction"):null}var tV=s(38362);let t$=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,P.h)(),[s,i]=(0,b.useState)(""),n=(0,o.aP)(e=>e.lastMessageId),r=(0,o.aP)(e=>e.streamedMessageId),l=(0,U.A3)(e=>e.byId),d=l[n||""],c=l[r||""],u=(0,b.useMemo)(()=>{let e=d;for(;e&&"human"!==e.sender;)e=e.parentResponseId?l[e.parentResponseId]:void 0;return null==e?void 0:e.message},[d,l]),[m,p]=(0,_.M)("notifications-toast-dismiss-count",0),[g,h]=(0,b.useState)(0),x=(0,b.useRef)(new Set),f=(0,D.C$)(e=>e.userSettings.preferences.browserNotificationsEnabled),v=(0,b.useCallback)(()=>{var s,a;if((null==(s=document)?void 0:s.hasFocus())||!(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS))return;let i=null==d||null==(a=d.uiLayout)?void 0:a.reasoningUiLayout;if("HEAVY"!==i&&"UNIFIED"!==i)return;let n="HEAVY"===i?e("notifications-heavy-answer-ready","Grok Heavy answer is ready"):e("notifications-answer-ready","Grok answer is ready"),r=window.matchMedia("(prefers-color-scheme: dark)").matches?"/images/notification-icon-dark.png":"/images/notification-icon-light.png";new Notification(n,u?{body:e("notifications-check-results-with-message",'Check results for "{{userMessage}}"',{userMessage:u}),icon:r}:{icon:r}).onclick=()=>{window.focus()}},[null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS,d,u,e]),y=(0,b.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];L.oR.dismiss(s),i(""),e&&p(e=>e+1)},[p,s]),w=!!(null==c?void 0:c.liveThinkingStartTime)||!!(null==c?void 0:c.thinkingStartTime)||!!(null==c?void 0:c.searchingStartTime)||(null==c?void 0:c.steps)&&c.steps.length>0;return(0,b.useEffect)(()=>{if(!f&&c&&w){if((null==c?void 0:c.state)==="streaming")return void h(1e3);(null==d?void 0:d.state)==="closed"&&h(0)}},[c,d,f,w]),(0,b.useEffect)(()=>{if(0===g||f)return;let e=setTimeout(()=>h(e=>e+1e3),1e3);return()=>clearTimeout(e)},[f,g]),(0,b.useEffect)(()=>{let e=g>=3e3&&g<=4e3;!s&&!f&&e&&m<1&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&i((0,L.oR)((0,a.jsx)(tY,{onDismiss:y}),{duration:1/0,className:"inset-x-0 mx-auto"}))},[m,y,null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS,g,s]),(0,b.useEffect)(()=>{(null==d?void 0:d.liveThinkingStartTime)&&(null==d?void 0:d.state)==="closed"&&(f&&n&&!x.current.has(n)&&(v(),x.current.add(n)),s&&(d.partial?y(!1):setTimeout(()=>y(!1),2e3)))},[f,y,d,v,s,n]),v},tY=e=>{let{onDismiss:t}=e,{t:s}=(0,j.Bd)("base"),[i,n]=(0,b.useState)("ASK"),r=(0,D.C$)(z.A("fetchSetPreference")),l=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,b.useEffect)(()=>{if("ASK"===i||"WAIT"===i)return;let e=setTimeout(t,2e3);return()=>clearTimeout(e)},[t,i]),(0,h.f)())?null:"DENIED"===i?(0,a.jsxs)("div",{className:"flex items-center gap-4 min-w-[360px]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_declined_title","Notifications declined")}),(0,a.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_change_anytime","You can change this anytime in settings.")})]}),(0,a.jsx)(m.X,{className:"size-5"})]}):"ALLOWED"===i?(0,a.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,a.jsx)(m.Jlk,{className:"size-5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_enabled_title","Notifications enabled")}),(0,a.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,a.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[360px]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(m.ZVq,{className:"size-5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_ask_title","Get notified when Grok finishes answering")}),(0,a.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_ask_subtitle","Enable notifications")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 -me-2",children:[(0,a.jsx)(p.$n,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===i,onClick:l,children:s("notifications_enable","Enable")}),(0,a.jsx)(p.$n,{variant:"textSecondary",size:"iconXs","aria-label":s("notifications-toast-dismiss","Dismiss"),onClick:()=>t(!0),children:(0,a.jsx)(m.X,{className:"!size-4"})})]})]})};function tQ(e){let{conversationId:t,lastMessageId:s}=e,{t:i}=(0,j.Bd)("chat"),n=(0,o.aP)(z.A("requestShareDialogOpen")),r=(0,o.aP)(z.A("setRequestShareDialogOpen")),l=(0,H.Di)(),d=(0,A._)(),c=(0,b.useCallback)(e=>{r(e)},[r]);(0,b.useEffect)(()=>{n&&d("request_share_dialog_opened",void 0,{location:"request-share-dialog"})},[d,n]);let p=(0,b.useCallback)(()=>{r(!1)},[r]),g=(0,b.useCallback)(()=>{d("request_share_dialog_share_pressed",void 0,{location:"request-share-dialog"}),L.oR.success(i("share-request-dialog.share-success","Conversation shared!")),r(!1)},[r,d,i]),h=(0,b.useCallback)(()=>(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,a.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-can-only-see-current-messages","Viewers will be only able to see current messages at time of sharing.")})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,a.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-cannot-add-or-modify","Viewers will not be able to add or modify this conversation.")})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 border rounded-md",children:[(0,a.jsx)(m.hcu,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-secondary font-semibold",children:[i("share-request-dialog.note","Note"),":"]}),(0,a.jsx)("p",{className:"text-sm italic text-secondary",children:i("share-request-dialog.sharing-this-conversation-means-anybody-with-the-share-link-will-be-able-to-view-it","Sharing this conversation means anybody with the share link will be able to view it.")})]})]}),(0,a.jsxs)("div",{className:"w-full flex items-center gap-2 justify-end",children:[(0,a.jsx)(eB.$n,{variant:"secondary",size:"md",shape:"rectangle",onClick:p,children:i("share-request-dialog.cancel","Cancel")}),t&&s&&(0,a.jsx)(u.w,{variant:"primary",size:"md",conversationId:t,responseId:s,iconProps:{size:18,strokeWidth:2},showLabel:!0,className:"rounded-xl",onClick:g})]})]}),[t,p,g,s,i]);return l?(0,a.jsx)(W._s,{open:n,onOpenChange:c,children:(0,a.jsxs)(W.zj,{className:"focus:outline-none bg-surface-l1 pt-1 p-6 h-[80dvh] mb-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")}),h()]})}):(0,a.jsx)(ee.lG,{open:n,onOpenChange:c,children:(0,a.jsxs)(ee.Cf,{className:"sm:max-w-md rounded-3xl border border-border-l1 p-6",children:[(0,a.jsxs)(ee.c7,{children:[(0,a.jsx)(ee.L3,{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,a.jsx)(ee.rr,{className:"text-sm text-muted-foreground",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")})]}),h()]})})}function tX(){let e=(0,P.h)(),t=(0,Q.K)(),{signInWithReturnTo:s}=(0,el.o)(),{user:l}=(0,ei.useSession)(),{handleVoiceModeEnter:d}=(0,en.F)({location:"voice-chat-page"}),c=(0,o.aP)(z.A("optimisticConversationId")),u=(0,o.aP)(z.A("conversationId")),m=(0,o.aP)(z.A("lastMessageId")),p=(0,em.w1)(z.A("fetchGetConversation")),g=(0,o.aP)(z.A("conversationMode")),h=(0,o.aP)(z.A("voiceConnectionStatus")),x=(0,o.aP)(z.A("exitVoiceMode")),v=(0,O.j)(z.A("isOpen")),y=(0,ep.useSearchParams)(),w=(0,ep.useRouter)(),I=(0,ep.usePathname)(),{route:N,replace:S}=(0,eu.wK)();(0,b.useEffect)(()=>{var e;if("chat"===N.page&&N.temporary)return;let t="chat"===N.page&&null!=(e=N.conversationId)?e:void 0;o.aP.setState({conversationId:t})},[N]);let C=(0,o.aP)(z.A("setRequestShareDialogOpen"));(0,b.useEffect)(()=>{let e="SHARE_REQUESTED";if("true"===y.get(e)){C(!0);let t=new URLSearchParams(y.toString());t.delete(e),w.replace("".concat(I,"?").concat(t.toString()),{scroll:!1})}},[I,w,y,C]),t$(),function(){let e=(0,ep.useSearchParams)(),{t}=(0,j.Bd)("chat"),s=(0,ep.useRouter)(),a=(0,b.useRef)(!1),i=e.get(er.il),n=(0,ec.M4)(i||"");(0,b.useEffect)(()=>{if(!a.current&&i){setTimeout(()=>L.oR.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),a.current=!0;let e=new URL(window.location.href);e.searchParams.delete(er.il),s.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,i,s,t])}(),function(e){let t=(0,em.w1)(t=>e?t.byId[e]:void 0);(0,eo.r)(null==t?void 0:t.title)}(u);let{data:M,isLoading:E,error:_}=(0,ed.v)(u?p(u):void 0);(0,b.useEffect)(()=>{o.aP.getState().setChatPageLoaded(!0)},[]),(0,b.useEffect)(()=>{v&&"voice"===g&&x("navigation").catch(e=>{t("chat-page:exitVoiceMode",e)})},[v,g,x,t]),(0,b.useEffect)(()=>{if("voice"in N&&N.voice&&"voice"!==g&&(S({page:"main",voice:!1}),e.ENABLE_VOICE_MODE))if(l)d().catch(e=>(0,f.vV)("chat-page:handleVoiceModeEnter",e));else{(0,f.iu)("sign_in","voice-chat-page",{location:"voice-chat-page"}),s(void 0,void 0,!0);return}},[N,S,g,d,h,l,s,e]);let A=(0,b.useRef)(null);return(0,a.jsx)(r.t,{fallbackRender:()=>(0,a.jsx)(tJ,{}),children:(0,a.jsxs)("main",{ref:A,className:(0,k.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[u&&m&&(0,a.jsx)(tQ,{conversationId:u,lastMessageId:m}),(0,a.jsx)(n.a,{hidden:!0}),(0,a.jsx)(tV.g,{conversationId:u,containerRef:A,user:l}),(0,a.jsx)(eA.hx,{showTasks:!0,conversationIsLoading:E,conversation:M||void 0,isOptimisticConversation:!!c}),(0,a.jsx)(i.CommandMenu,{}),c&&"main"===N.page||u&&"chat"===N.page?(0,a.jsx)(tW,{optimisticConversationId:c,conversationIsLoading:E,conversationError:_,conversationId:u,conversation:M},"conversation-view"):(0,a.jsx)(tq,{}),(0,a.jsx)(ea,{})]},"chat-page")})}function tJ(){let{t:e}=(0,j.Bd)("chat");return(0,a.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,a.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,a.jsx)(eu.N_,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,a.jsx)(l.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,a.jsx)("div",{children:e("There was an error","There was an error")}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(p.$n,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}},76393:(e,t,s)=>{s.d(t,{p:()=>n});var a=s(79342),i=s(61312);let n=e=>{let{value:t,formatter:s,prefix:n,suffix:r,className:l}=e,o=t>0?"+":t<0?"-":"",d=Math.abs(t),c=s?s(d):d;return(0,a.jsxs)("span",{className:(0,i.cn)(t>0?"text-teal-300":t<0?"text-red-300":"text-muted-foreground",l),children:[n,!!o&&o,c,r]})}},93220:(e,t,s)=>{s.d(t,{$:()=>l});var a=s(79342),i=s(61312),n=s(11750),r=s(23054);let l=e=>{let{className:t}=e;return(0,a.jsx)(r.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,i.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,a.jsx)(n.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")}}}]);